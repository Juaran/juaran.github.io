<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="Vic2ray" />
  <meta name="description" content="" />
  
  
  <title>
    
      【研一上】后台管理系统适配前端页面 
      
      
      |
    
     Vic2ray&#39;s Blog
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/color-scheme.css">
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/comments.css">


  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>

<meta name="generator" content="Hexo 6.1.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">Vic2ray</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">主页</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">归档</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">分类</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">标签</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">关于</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->

<!-- LaTex Display -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>



  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">【研一上】后台管理系统适配前端页面</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="更新时间"></i>
          2021-01-16 16:00:00
        </span>
        
              <span class="post-categories">
                <i class="iconfont icon-bookmark" title="分类"></i>
                
                <span class="span--category">
                  <a href="/categories/project/" title="project">
                    <b>#</b> project
                  </a>
                </span>
                
              </span>
          
              <span class="post-tags">
                <i class="iconfont icon-tags" title="标签"></i>
                
                <span class="span--tag">
                  <a href="/tags/%E5%91%A8%E6%8A%A5/" title="周报">
                    <b>#</b> 周报
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <h2 id="项目目标"><a href="#项目目标" class="headerlink" title="项目目标"></a>项目目标</h2><ol>
<li>将若依后台管理系统的Oracle数据库版本的前端页面更换为若依-Layui项目的前端页面；</li>
<li>按需求新增站点管理，其他表按需增加字段；</li>
<li>前端页面适配IE8浏览器。</li>
</ol>
<h3 id="一、项目地址"><a href="#一、项目地址" class="headerlink" title="一、项目地址"></a>一、项目地址</h3><ul>
<li><strong>RuoYi-Oracle</strong>：<a target="_blank" rel="noopener" href="https://github.com/yangzongzhuan/RuoYi-Oracle">https://github.com/yangzongzhuan/RuoYi-Oracle</a></li>
</ul>
<p>若依后台管理系统Oracle版本。</p>
<ul>
<li><strong>ruoyi-layui</strong>：<a target="_blank" rel="noopener" href="https://gitee.com/flying_stars/ruoyi-layui">https://gitee.com/flying_stars/ruoyi-layui</a></li>
</ul>
<p>结合<code>RuoYiPlus</code>项目在<code>RuoYi</code>项目基础上改造成layui版本。</p>
<h3 id="二、Oracle数据库"><a href="#二、Oracle数据库" class="headerlink" title="二、Oracle数据库"></a>二、Oracle数据库</h3><p>数据库地址：<a target="_blank" rel="noopener" href="https://github.com/yangzongzhuan/RuoYi-Oracle/tree/master/sql">https://github.com/yangzongzhuan/RuoYi-Oracle/tree/master/sql</a></p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/yangzongzhuan/RuoYi-Oracle/blob/master/sql/ry_20201214.sql">ry_20201214.sql  </a>主要数据</li>
<li><a target="_blank" rel="noopener" href="https://github.com/yangzongzhuan/RuoYi-Oracle/blob/master/sql/quartz.sql">quartz.sql    </a>定时任务数据</li>
</ol>
<h4 id="Docker安装Oracle"><a href="#Docker安装Oracle" class="headerlink" title="Docker安装Oracle"></a>Docker安装Oracle</h4><p>由于甲骨文数据库商用收费，个人使用免费，在DockerHub中并没有直接可用的Oracle镜像，要么自己手动安装制作镜像，要么使用个人制作好的.</p>
<ol>
<li>下载镜像：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g</span><br></pre></td></tr></table></figure>

<p>注：oracle_11g是Oracle数据库的版本号11g。</p>
<ol start="2">
<li>启动容器：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -d -p 1521:1521 --name juneoracle registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>配置容器：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it juneoracle bash	// 进入容器</span><br><span class="line">su root 	// 切换至root，密码helowin</span><br><span class="line">vi /etc/profile		// 配置环境变量</span><br><span class="line"></span><br><span class="line">export ORACLE_HOME=/home/oracle/app/oracle/product/11.2.0/dbhome_2</span><br><span class="line">export ORACLE_SID=helowin</span><br><span class="line">export PATH=$ORACLE_HOME/bin:$PATH</span><br><span class="line"></span><br><span class="line">source /etc/profile		// 生效</span><br><span class="line">ln -s $ORACLE_HOME/bin/sqlplus /usr/bin		// 软连接</span><br><span class="line">su - oracle	// 切换用户</span><br><span class="line">sqlplus /nolog	// 连接数据库</span><br><span class="line"></span><br><span class="line">conn /as sysdba</span><br><span class="line">alter user system identified by 123456;		// system密码</span><br><span class="line">alter user sys identified by 123456;	// sys密码</span><br><span class="line">create user root identified by 123456;	// 创建用户</span><br><span class="line">grant connect,resource,dba to root;		// 授权</span><br><span class="line">alter profile default limit PASSWORD_LIFE_TIME UNLIMITED;	// 密码不过期</span><br><span class="line"></span><br><span class="line">conn /as sysdba		// 重启数据库</span><br><span class="line">shutdown immediate;</span><br><span class="line">startup;</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<p>参考：<a target="_blank" rel="noopener" href="https://my.oschina.net/u/4396922/blog/4535903">https://my.oschina.net/u/4396922/blog/4535903</a></p>
<p>Navicat连接信息：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/image-20211019161547143.png" alt="image-20211019161547143" style="zoom: 80%;" />

<ol start="4">
<li>运行sql文件，创建表</li>
</ol>
<h3 id="三、页面移植"><a href="#三、页面移植" class="headerlink" title="三、页面移植"></a>三、页面移植</h3><p>Idea导入Ruoyi-Oracle项目，安装Maven相关依赖。</p>
<h4 id="3-1-配置数据源"><a href="#3-1-配置数据源" class="headerlink" title="3.1 配置数据源"></a>3.1 配置数据源</h4><blockquote>
<p>\ruoyi-admin\src\main\resources\application-druid.yml</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主库数据源</span></span><br><span class="line"><span class="attr">master:</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">jdbc:oracle:thin:@172.17.171.8:1521/helowin</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p>修改为Oracle数据库的连接地址、服务名、用户名、密码。</p>
<h4 id="3-2-替换前端页面"><a href="#3-2-替换前端页面" class="headerlink" title="3.2 替换前端页面"></a>3.2 替换前端页面</h4><p>前端页面模板及静态资源文件主要位置：</p>
<ol>
<li>\ruoyi-admin\src\main\resources\static</li>
<li>\ruoyi-admin\src\main\resources\template</li>
</ol>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/image-20211019161803376.png" alt="image-20211019161803376" style="zoom:67%;" />

<ul>
<li>删除这两个文件夹，替换为ruoyi-layui项目的对应目录文件夹。</li>
</ul>
<p>重新登录，index页面报错：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/image-20211019161828654.png" alt="image-20211019161828654" style="zoom:67%;" />

<p>查看报错信息：</p>
<p><img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/a9ee1818-b5c6-40fb-a6d7-55bb056400d0.png" alt="img"></p>
<p>全局搜索：com.ruoyi.web.utils.UserUtils</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/45c9cb92-0dea-48d9-93f9-ddccec490410.png" alt="img" style="zoom: 67%;" />

<p>这两个页面引用了 UserUtils 包。在ruoyi-layui 项目复制这个包到对应目录下，并解决相关依赖问题：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/image-20211019164009447.png" alt="image-20211019164009447" style="zoom: 67%;" />

<p>重新运行项目，便可以登录进入首页。</p>
<h4 id="3-3-用户管理"><a href="#3-3-用户管理" class="headerlink" title="3.3 用户管理"></a>3.3 用户管理</h4><img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/416d8620-5580-45c2-9e1b-15c9c08d104b.png" alt="img" style="zoom: 50%;" />

<p>查看请求数据接口：</p>
<ol>
<li>&#x2F;system&#x2F;user&#x2F;list</li>
<li>&#x2F;system&#x2F;dept&#x2F;treeData2</li>
</ol>
<p>先解决用户列表接口问题。启动ruoyi-layui,查看对应返回数据接口返回数据，与之对比：</p>
<p><img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/6f864d2e-982d-42ff-ae9c-f4d1b8a5f0e2.png" alt="img"><img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/cc513f19-24ba-4484-9b66-f7b637cc4941.png" alt="img"></p>
<p>对比发现：返回rows字段应对应data、total字段应对应count。</p>
<p>定位到用户管理页面：\ruoyi-admin\src\main\resources\templates\system\user\user.html</p>
<p>定位到user表格渲染位置，在render函数末尾增加layui表格数据解析：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/eed2331c-5bac-4f7d-aed1-f0b18a054bc3.jpg" alt="img" style="zoom:67%;" />

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">,parseData: function(res)&#123; <span class="comment">//res 即为原始返回的数据</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;code&quot;</span>: res.code, <span class="comment">//解析接口状态</span></span><br><span class="line">        <span class="string">&quot;msg&quot;</span>: res.msg, <span class="comment">//解析提示文本</span></span><br><span class="line">        <span class="string">&quot;count&quot;</span>: res.total, <span class="comment">//解析数据长度</span></span><br><span class="line">        <span class="string">&quot;data&quot;</span>: res.rows <span class="comment">//解析数据列表</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样使得后台返回数据对应表格渲染数据字段，页面成功展示：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/1776d528-7066-4ffb-bf3c-85e19fb1b8f2.png" alt="img" style="zoom:50%;" />

<p>接下来解决&#x2F;system&#x2F;dept&#x2F;treeData2接口。定位到SysDeptController，&#x2F;treeData路由：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/8eef843a-1a79-44da-8bfc-c2a09a81327b.jpg" alt="img" style="zoom: 67%;" />

<p>而请求的路由地址为：&#x2F;treeData2。在ruoyi-layui项目对应位置查找，发现以下路由方法：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/dc6da759-b03c-4221-9315-1a62c5fadf17.png" alt="img" style="zoom:67%;" />

<p>可以看出改方法在treeData的基础上进行<strong>EleTreeWrapper</strong>封装，并加入code、data字段。复制该路由方法到Oracle项目，并引入EleTreeWrapper包，与controller包同级：</p>
<p><img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/e19edb2d-88e8-48c7-9887-13ba20d44866.png" alt="img"></p>
<p>发现deptService.selectDpetTree方法返回值类型不匹配：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/837fd604-ea95-4f2a-96d1-e27e06b73290.png" alt="img" style="zoom:67%;" />

<p>定位到接口：ISysDeptService，在selectDeptTree下新增方法<strong>selectDeptTreee</strong>：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/79b3b4dc-a5f7-40e9-b332-013854579278.jpg" alt="img" style="zoom:67%;" />

<p>在接口实现类SysDeptServiceImpl中selectDeptTree下方添加该方法，只需要将ruoyi-layui中对应方法复制过来即可，注意getTrees方法也要复制：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@DataScope(deptAlias = &quot;d&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectDeptTreee</span><span class="params">(SysDept dept)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; trees = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Map&lt;String, Object&gt;&gt;();</span><br><span class="line">    List&lt;SysDept&gt; deptList = deptMapper.selectDeptList(dept);</span><br><span class="line">    trees = getTrees(deptList, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">return</span> trees;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Controller的treeData2方法内调用新的函数<strong>selectDeptTreee</strong>。重新运行项目，用户管理页面已经生效：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/19e14be4-7293-4987-bf89-32839c206709.png" alt="img" style="zoom:67%;" />

<h4 id="3-4-角色管理"><a href="#3-4-角色管理" class="headerlink" title="3.4 角色管理"></a>3.4 角色管理</h4><p>页面同样不显示，发现与前面&#x2F;system&#x2F;user&#x2F;list接口一样，返回数据类型解析不一致所致。</p>
<p>定位到前端页面：\ruoyi-admin\src\main\resources\templates\system\role\role.html定位到表格渲染位置：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/6a794980-8d7c-41c3-beae-1b898f941e68.jpg" alt="img" style="zoom:67%;" />

<p>末尾增加解析： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">,parseData: function(res)&#123; <span class="comment">//res 即为原始返回的数据</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;code&quot;</span>: res.code, <span class="comment">//解析接口状态</span></span><br><span class="line">        <span class="string">&quot;msg&quot;</span>: res.msg, <span class="comment">//解析提示文本</span></span><br><span class="line">        <span class="string">&quot;count&quot;</span>: res.total, <span class="comment">//解析数据长度</span></span><br><span class="line">        <span class="string">&quot;data&quot;</span>: res.rows <span class="comment">//解析数据列表</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>页面数据表格渲染成功：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/image-20211019162305612.png" alt="image-20211019162305612" style="zoom:67%;" />

<p>最后，角色-部门<strong>数据权限列表树</strong>部分需要修改。</p>
<p>定位请求为：&#x2F;system&#x2F;role&#x2F;rule&#x2F;1，页面是：\ruoyi-admin\src\main\resources\templates\system\role\role.html。</p>
<p>定位到SysRoleController，查找&#x2F;rule相关路由方法（为角色增加数据权限），发现与之相似的是&#x2F;authDataScope路由，看来是做了新的实现。这里依旧复制ruoyi-layui对应位置的&#x2F;rule路由相关代码到项目中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增数据权限</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/rule/&#123;roleId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">rule</span><span class="params">(<span class="meta">@PathVariable(&quot;roleId&quot;)</span> Long roleId, ModelMap mmap)</span></span><br><span class="line">&#123;</span><br><span class="line">    mmap.put(<span class="string">&quot;role&quot;</span>, roleService.selectRoleById(roleId));</span><br><span class="line">    <span class="keyword">return</span> prefix + <span class="string">&quot;/rule&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改保存数据权限</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequiresPermissions(&quot;system:role:edit&quot;)</span></span><br><span class="line"><span class="meta">@Log(title = &quot;角色管理&quot;, businessType = BusinessType.UPDATE)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/rule&quot;)</span></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">ruleSave</span><span class="params">(SysRole role)</span></span><br><span class="line">&#123;</span><br><span class="line">    role.setUpdateBy(ShiroUtils.getLoginName());</span><br><span class="line">    <span class="keyword">return</span> toAjax(roleService.updateRule(role));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现roleService.updateRule方法报红，添加相应方法接口及实现。ISysRoleService：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改数据权限信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> role 角色信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateRule</span><span class="params">(SysRole role)</span>;</span><br></pre></td></tr></table></figure>

<p>SysRoleServiceImpl实现方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改数据权限信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> role 角色信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateRule</span><span class="params">(SysRole role)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 修改角色信息</span></span><br><span class="line">    roleMapper.updateRole(role);</span><br><span class="line">    <span class="comment">// 删除角色与部门关联</span></span><br><span class="line">    roleDeptMapper.deleteRoleDeptByRoleId(role.getRoleId());</span><br><span class="line">    <span class="comment">// 新增角色和部门信息（数据权限）</span></span><br><span class="line">    <span class="keyword">return</span> insertRoleDept(role);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决了角色权限后，还需要解决部门角色对应关系。复制ruoyil-ayui下的SysDeptController的&#x2F;roleDeptTreeData2路由方法到&#x2F;roleDeptTreeData后面：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/c2874ee7-c531-47c4-84ae-ece3e0eb5356.jpg" alt="img" style="zoom:67%;" />

<p>报红，同样需要添加Map&lt;String, Object&gt;类型的方法。定位到接口实现类ISysDeptService，在roleDeptTreeData下新增方法：roleDeptTreeData2</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/d130e47c-fb48-4901-8704-47e5a305045e.jpg" alt="img" style="zoom:67%;" />

<p>并在实现类SysDeptServiceImpl中实现该方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">roleDeptTreeData2</span><span class="params">(SysRole role)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">roleId</span> <span class="operator">=</span> role.getRoleId();</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; trees = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Map&lt;String, Object&gt;&gt;();</span><br><span class="line">    List&lt;SysDept&gt; deptList = selectDeptList(<span class="keyword">new</span> <span class="title class_">SysDept</span>());</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotNull(roleId))</span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;String&gt; roleDeptList = deptMapper.selectRoleDeptTree(roleId);</span><br><span class="line">        trees = getTrees(deptList, <span class="literal">true</span>, roleDeptList);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        trees = getTrees(deptList, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> trees;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在原Controller内调用方法改为roleDeptTreeData2，数据权限页面添加成功：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/22bd30ff-3d27-426a-984e-236a1eed8d03.png" alt="img" style="zoom:67%;" />

<h4 id="3-5-菜单管理"><a href="#3-5-菜单管理" class="headerlink" title="3.5 菜单管理"></a>3.5 菜单管理</h4><p>菜单页面显示不出来，查看接口：&#x2F;system&#x2F;menu&#x2F;listTreeGridData</p>
<p>定位到SysMenuController发现并没有对应的listTreeGridData路由方法，在ruoyi-layui项目中找到对应路由函数，复制到list路由函数下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiresPermissions(&quot;system:menu:list&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/listTreeGridData&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Map <span class="title function_">listTreeGridData</span><span class="params">(SysMenu menu)</span> &#123;</span><br><span class="line">    <span class="type">Map</span> <span class="variable">retMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> ShiroUtils.getUserId();</span><br><span class="line">    List&lt;SysMenu&gt; menuList = menuService.selectMenuList(menu, userId);</span><br><span class="line">    retMap.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    retMap.put(<span class="string">&quot;code&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    retMap.put(<span class="string">&quot;data&quot;</span>, menuList);</span><br><span class="line">    retMap.put(<span class="string">&quot;count&quot;</span>, menuList != <span class="literal">null</span> ? menuList.size() : <span class="number">0</span>);</span><br><span class="line">    retMap.put(<span class="string">&quot;is&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">    retMap.put(<span class="string">&quot;tip&quot;</span>, <span class="string">&quot;操作成功&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> retMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意参照原&#x2F;list函数需要在selectMenuList方法内添加userId参数。最终页面显示完成：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/5863f355-fd4c-4e9f-8b0d-330593e73792.png" alt="img" style="zoom:67%;" />

<h4 id="3-6-部门管理"><a href="#3-6-部门管理" class="headerlink" title="3.6 部门管理"></a>3.6 部门管理</h4><p>部门管理的处理方法与菜单管理页面相同。在SysDeptController的&#x2F;list路由下增加&#x2F;listTreeGridData：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiresPermissions(&quot;system:dept:list&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/listTreeGridData&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Map <span class="title function_">listTreeGridData</span><span class="params">(SysDept dept)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Map</span> <span class="variable">retMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    List&lt;SysDept&gt; deptList = deptService.selectDeptList(dept);</span><br><span class="line">    retMap.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    retMap.put(<span class="string">&quot;code&quot;</span>,<span class="number">0</span>);</span><br><span class="line">    retMap.put(<span class="string">&quot;data&quot;</span>,deptList);</span><br><span class="line">    retMap.put(<span class="string">&quot;count&quot;</span>,deptList!=<span class="literal">null</span>?deptList.size():<span class="number">0</span>);</span><br><span class="line">    retMap.put(<span class="string">&quot;is&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">    retMap.put(<span class="string">&quot;tip&quot;</span>,<span class="string">&quot;操作成功&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> retMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其次，替换新增部门&#x2F;add路由方法，解决当选择部门为0时的错误，改为默认添加到主部门：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/13dc2c92-e43e-449b-af56-6db04aafd65e.jpg" alt="img" style="zoom:67%;" />

<p>部门管理页面迁移成功：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/27324497-1ec5-4fae-9d4f-59c2caffcfb5.png" alt="img" style="zoom:67%;" />

<h4 id="3-7-其余页面"><a href="#3-7-其余页面" class="headerlink" title="3.7 其余页面"></a>3.7 其余页面</h4><ul>
<li><p>岗位管理：post页面。接口解析更换即可。</p>
</li>
<li><p>字典管理：dict页面。更换接口解析。注意data&#x2F;type两个页面都要解析。</p>
</li>
<li><p>参数设置：config页面。</p>
</li>
<li><p>通知公告：notice页面。</p>
</li>
<li><p>登录日志：&#x2F;monitor&#x2F;logininfor&#x2F;logininfor.html</p>
</li>
<li><p>操作日志：&#x2F;monitor&#x2F;operlog&#x2F;operlog.html</p>
</li>
<li><p>在线用户：&#x2F;monitor&#x2F;online&#x2F;online.html  </p>
</li>
<li><p>定时任务：&#x2F;monitor&#x2F;job&#x2F;job.html  </p>
</li>
<li><p>代码生成：&#x2F;tool&#x2F;gen&#x2F;gen&#x2F;gen.html和importTable页面</p>
</li>
</ul>
<h3 id="四、新增功能"><a href="#四、新增功能" class="headerlink" title="四、新增功能"></a>四、新增功能</h3><h4 id="4-1-新增站点"><a href="#4-1-新增站点" class="headerlink" title="4.1 新增站点"></a>4.1 新增站点</h4><p>站点信息表建表sql语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-- ----------------------------</span><br><span class="line">-- 站点信息表</span><br><span class="line">-- ----------------------------</span><br><span class="line">create sequence seq_sys_site</span><br><span class="line"> increment by 1</span><br><span class="line"> start with 100</span><br><span class="line"> nomaxvalue</span><br><span class="line"> nominvalue</span><br><span class="line"> cache 20;</span><br><span class="line"></span><br><span class="line">create table sys_site (</span><br><span class="line">  site_id           number(20)      not null,</span><br><span class="line">  site_name         varchar2(30)    not null,</span><br><span class="line">	site_desc         varchar2(100),</span><br><span class="line">	site_url         	varchar2(100) not null,</span><br><span class="line">	site_img         	varchar2(100) not null,</span><br><span class="line">  site_sort         number(4)       not null,</span><br><span class="line">  status            char(1)         not null,</span><br><span class="line">	site_type 				varchar2(30)    not null,</span><br><span class="line">  create_by         varchar2(64)    default &#x27;&#x27;,</span><br><span class="line">  create_time       date,</span><br><span class="line">  update_by         varchar2(64)    default &#x27;&#x27;,</span><br><span class="line">  update_time       date</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>使用代码生成器（注意需要使用Orcel原版工程的代码生成器，layui版本生成器是mysql数据格式）</strong>下载代码，复制到项目对应位置。注意template页面不需要。</p>
<p><img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/00668fb5-6f6a-41ab-bf5f-8e23f5021ce4.png" alt="img" style="zoom: 80%;" /><img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/39a85586-1e6b-4f01-85af-00b1e39f359b.png" alt="img" style="zoom:67%;" /></p>
<p>点击菜单管理页面，在系统管理栏目下新增站点管理菜单：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/bf6fee0a-bf55-45c4-8e15-a88f5160cfa1.png" alt="img" style="zoom:67%;" />

<p>在template页面模板下，复制一份post岗位页面的代码，改文件夹名称为site；</p>
<p>重命名post.html为site.html，搜索全部post字符串替换为site，注意post提交不要变；</p>
<p>更改页面header为站点管理；更改搜索框名称及name属性：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/3a9a6aa5-5356-4ff1-9938-afb1a23ace84.png" alt="img" style="zoom:67%;" />

<p>重新编辑table.render内的表格cols列字段为site表的字段属性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">, cols: new Array([</span><br><span class="line">    &#123;type: &#x27;checkbox&#x27;, width: 40&#125;</span><br><span class="line">    , &#123;field: &#x27;siteName&#x27;, title: &#x27;站点名称&#x27;, width: 100&#125;</span><br><span class="line">    , &#123;field: &#x27;siteDesc&#x27;, title: &#x27;站点描述&#x27;, width: 100&#125;</span><br><span class="line">    , &#123;field: &#x27;siteUrl&#x27;, title: &#x27;站点地址&#x27;, width: 160&#125;</span><br><span class="line">    , &#123;field: &#x27;siteImg&#x27;, title: &#x27;站点图标&#x27;, width: 160&#125;</span><br><span class="line">    , &#123;field: &#x27;siteType&#x27;, title: &#x27;站点类型&#x27;, width: 80&#125;</span><br><span class="line">    , &#123;field: &#x27;siteSort&#x27;, sort: true, width: 100, title: &#x27;显示顺序&#x27;&#125;</span><br><span class="line">    , &#123;</span><br><span class="line">        field: &#x27;status&#x27;, width: 80, title: &#x27;状态&#x27;,</span><br><span class="line">        templet: function (item) &#123;</span><br><span class="line">            if (item.status === &quot;0&quot;) &#123;</span><br><span class="line">                return &quot;&lt;span class=\&quot;layui-btn layui-btn-xs layui-btn-radius\&quot;&gt;正常&lt;/span&gt;&quot;;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return &quot;&lt;span class=\&quot;layui-btn layui-btn-xs layui-btn-danger layui-btn-radius\&quot;&gt;停用&lt;/span&gt;&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    , &#123;field: &#x27;createBy&#x27;, title: &#x27;创建者&#x27;&#125;</span><br><span class="line">    , &#123;field: &#x27;createTime&#x27;, title: &#x27;创建时间&#x27;, width: 160, sort: true&#125;</span><br><span class="line">    , &#123;field: &#x27;updateBy&#x27;, title: &#x27;更新者&#x27;&#125;</span><br><span class="line">    , &#123;field: &#x27;updateTime&#x27;, title: &#x27;更新时间&#x27;, width: 160, sort: true&#125;</span><br><span class="line">    , &#123;title: &#x27;操作&#x27;, width: 100, toolbar: &#x27;#col_operation&#x27;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<p>清理Maven缓存，重启项目，进入站点菜单，测试增查询操作：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/d31ace54-d4b8-414c-80ab-9e576cdfde6f.png" alt="img" style="zoom:67%;" />

<p>接下来修改编辑页edit.html：<br>搜索替换post为site；发现引用了&#x2F;js&#x2F;system&#x2F;site_form.js，复制post_form.js改名为site_form.js，同样替换post为site；</p>
<p>然后再仔细编辑edit页面中的表单字段，注意form获取对象为<strong>sysSite</strong>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;layui-form mt20&quot;</span> <span class="attr">lay-filter</span>=<span class="string">&quot;form-site&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;sysSite&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;siteId&quot;</span> <span class="attr">name</span>=<span class="string">&quot;siteId&quot;</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;siteId&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;required-msg &quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span>站点名称：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;siteName&quot;</span> <span class="attr">lay-verify</span>=<span class="string">&quot;required&quot;</span> <span class="attr">lay-verType</span>=<span class="string">&quot;tips&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;siteName&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;required-msg &quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span>站点描述：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;siteDesc&quot;</span> <span class="attr">lay-verify</span>=<span class="string">&quot;required&quot;</span> <span class="attr">lay-verType</span>=<span class="string">&quot;tips&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;siteDesc&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;required-msg &quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span>站点地址：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;siteUrl&quot;</span> <span class="attr">lay-verify</span>=<span class="string">&quot;required&quot;</span> <span class="attr">lay-verType</span>=<span class="string">&quot;tips&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;siteUrl&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;required-msg &quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span>站点图标：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;siteImg&quot;</span> <span class="attr">lay-verify</span>=<span class="string">&quot;required&quot;</span> <span class="attr">lay-verType</span>=<span class="string">&quot;tips&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;siteImg&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;required-msg &quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span>站点类型：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;siteType&quot;</span> <span class="attr">lay-verify</span>=<span class="string">&quot;required&quot;</span> <span class="attr">lay-verType</span>=<span class="string">&quot;tips&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;siteType&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;required-msg &quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span>显示顺序：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;siteSort&quot;</span> <span class="attr">lay-verify</span>=<span class="string">&quot;required|number&quot;</span> <span class="attr">lay-verType</span>=<span class="string">&quot;tips&quot;</span> <span class="attr">laceholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;siteSort&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span>站点状态：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:each</span>=<span class="string">&quot;dict : $&#123;@dict.getType(&#x27;sys_normal_disable&#x27;)&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">th:id</span>=<span class="string">&quot;$&#123;dict.dictCode&#125;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;status&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;dict.dictValue&#125;&quot;</span> <span class="attr">th:title</span>=<span class="string">&quot;$&#123;dict.dictLabel&#125;&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;status&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item layui-hide&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;layui-btn&quot;</span> <span class="attr">lay-submit</span> <span class="attr">lay-filter</span>=<span class="string">&quot;btn-edit&quot;</span> <span class="attr">id</span>=<span class="string">&quot;btn-edit&quot;</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后需要添加数据更新者的用户名。在SysSiteController的&#x2F;edit路由方法返回数据前添加：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysSite.setUpdateBy(ShiroUtils.getLoginName());</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/91a4ec4e-8778-4b7b-82c3-2d9707532f17.png" alt="img" style="zoom:67%;" />

<p>接下来是add.html，替换为site字符串，然后替换table内容：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;layui-form mt20&quot;</span> <span class="attr">lay-filter</span>=<span class="string">&quot;form-site&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;required-msg &quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span>站点名称：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;siteName&quot;</span> <span class="attr">lay-verify</span>=<span class="string">&quot;required&quot;</span> <span class="attr">lay-verType</span>=<span class="string">&quot;tips&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;required-msg &quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span>站点描述：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;siteDesc&quot;</span> <span class="attr">lay-verify</span>=<span class="string">&quot;required&quot;</span> <span class="attr">lay-verType</span>=<span class="string">&quot;tips&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;required-msg &quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span>站点地址：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;siteUrl&quot;</span> <span class="attr">lay-verify</span>=<span class="string">&quot;required&quot;</span> <span class="attr">lay-verType</span>=<span class="string">&quot;tips&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;required-msg &quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span>站点图标：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;siteImg&quot;</span> <span class="attr">lay-verify</span>=<span class="string">&quot;required&quot;</span> <span class="attr">lay-verType</span>=<span class="string">&quot;tips&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;required-msg &quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span>站点类型：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;siteType&quot;</span> <span class="attr">lay-verify</span>=<span class="string">&quot;required&quot;</span> <span class="attr">lay-verType</span>=<span class="string">&quot;tips&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;required-msg &quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span>显示顺序：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;siteSort&quot;</span> <span class="attr">lay-verify</span>=<span class="string">&quot;required|number&quot;</span> <span class="attr">lay-verType</span>=<span class="string">&quot;tips&quot;</span> <span class="attr">laceholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span>站点状态：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:each</span>=<span class="string">&quot;dict : $&#123;@dict.getType(&#x27;sys_normal_disable&#x27;)&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">th:id</span>=<span class="string">&quot;$&#123;dict.dictCode&#125;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;status&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;dict.dictValue&#125;&quot;</span> <span class="attr">th:title</span>=<span class="string">&quot;$&#123;dict.dictLabel&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item layui-hide&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;layui-btn&quot;</span> <span class="attr">lay-submit</span> <span class="attr">lay-filter</span>=<span class="string">&quot;btn-add&quot;</span> <span class="attr">id</span>=<span class="string">&quot;btn-add&quot;</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在增加时，还需要设置自增字段siteId，否则会插入空值错误。在SysSiteMapper.xml的insertSysSite项中添加属性到insert语句之前：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;siteId&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Long&quot;</span>&gt;</span></span><br><span class="line">	select seq_sys_site.nextval as siteId from DUAL</span><br><span class="line"><span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/6cb3cf38-28f3-4801-aff7-02ca0668140a.png" alt="img" style="zoom:67%;" />

<p>至此，站点管理的查询、增加、删除、修改功能已经完成。</p>
<h4 id="4-2-部门表增加类型等级"><a href="#4-2-部门表增加类型等级" class="headerlink" title="4.2 部门表增加类型等级"></a>4.2 部门表增加类型等级</h4><ul>
<li>DEPT_TYPE  部门类型</li>
<li>DEPT_LEVEL  部门等级</li>
</ul>
<p>首先在Oracle数据库中修改SYS_DEPT表结构，为其增加两个字段；</p>
<p>然后定位到\ruoyi-system\src\main\resources\mapper\system*<em>SysDeptMapper</em>*.xml</p>
<ol>
<li><p>在resultMap标签末尾添加数据库字段和实体属性映射：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/5e72f960-1fc3-4cf9-bce4-efc1508100b9.png" alt="img" style="zoom:80%;" />
</li>
<li><p>通过搜索<strong>phone</strong>字符串，看有那些操作需要增加这两个字段：</p>
</li>
</ol>
<ul>
<li><ul>
<li>selectDeptVo标签，sql语句增加 d.dept_type, d.dept_level</li>
<li>selectDeptById标签，语句增加 d.dept_type, d.dept_level</li>
<li>insertDept标签，语句末尾增加 insert into(xx) values(xx)</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">,</span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;deptType != null and deptType != &#x27;&#x27;&quot;</span>&gt;</span>dept_type,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;deptLevel != null and deptLevel != &#x27;&#x27;&quot;</span>&gt;</span>dept_level<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">,</span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;deptType != null and deptType != &#x27;&#x27;&quot;</span>&gt;</span>#&#123;deptType&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;deptLevel != null and deptLevel != &#x27;&#x27;&quot;</span>&gt;</span>#&#123;deptLevel&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>updateDept标签，末尾增加：</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">,</span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;deptType != null&quot;</span>&gt;</span>dept_type = #&#123;deptType&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;deptLevel != null&quot;</span>&gt;</span>dept_level = #&#123;deptLevel&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步，定位到SysDept实体类：\ruoyi-common\src\main\java\com\ruoyi\common\core\domain\entity*<em>SysDept</em>*.java</p>
<p>照着phone属性增加这两个字段，并实现其get、set方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 联系电话 */</span></span><br><span class="line"><span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 部门类型 */</span></span><br><span class="line"><span class="keyword">private</span> String deptType;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 部门等级 */</span></span><br><span class="line"><span class="keyword">private</span> String deptLevel;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getDeptType</span><span class="params">()</span> &#123; <span class="keyword">return</span> deptType; &#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getDeptLevel</span><span class="params">()</span> &#123; <span class="keyword">return</span> deptLevel; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDeptType</span><span class="params">(String deptType)</span> &#123; <span class="built_in">this</span>.deptType = deptType; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDeptLevel</span><span class="params">(String deptLevel)</span> &#123; <span class="built_in">this</span>.deptLevel = deptLevel; &#125;</span><br></pre></td></tr></table></figure>

<p>第三步，定位到到前端页面 dept&#x2F;edit.html 和 add.html，在form表单中增加这两个字段的表单控件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span>部门类型：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;deptType&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span>部门等级：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;deptLevel&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span>部门类型：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;deptType&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;deptType&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span>部门等级：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;layui-input min-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;deptLevle&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;deptLevel&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>至此，部门管理增加两个字段的工作已经完成。在页面中进行增删改查均有效。</p>
<h4 id="4-3-角色表增加角色类型"><a href="#4-3-角色表增加角色类型" class="headerlink" title="4.3 角色表增加角色类型"></a>4.3 角色表增加角色类型</h4><ol>
<li>角色表SYS_ROLE增加ROLE_TYPE字段</li>
<li>SysRoleMapper.xml语句增加roleType字段</li>
<li>SysRole实体类增加roleType属性和get&#x2F;set方法</li>
<li>template&#x2F;role&#x2F;edit.hml和add.html增加roleType表单控件，role.html表单渲染增加roleType字段</li>
</ol>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/image-20211019164648585.png" alt="image-20211019164648585" style="zoom:67%;" />

<h4 id="4-4-岗位表增加站点ID"><a href="#4-4-岗位表增加站点ID" class="headerlink" title="4.4 岗位表增加站点ID"></a>4.4 岗位表增加站点ID</h4><p>同以上两个新增字段任务的步骤和方法：</p>
<ol>
<li>岗位表SYS_POST增加SITE_ID字段</li>
<li>SysPostMapper.xml语句增加siteId字段</li>
<li>SysPost实体类增加siteId属性和get&#x2F;set方法</li>
<li>template&#x2F;post&#x2F;edit.hml和add.html增加siteId表单控件，post.html表单渲染增加siteId字段</li>
</ol>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/2c3a1b52-7799-47d4-b5bf-103bbf9717ce.png" alt="img" style="zoom:67%;" />

<h4 id="4-5-用户表增加其他账号"><a href="#4-5-用户表增加其他账号" class="headerlink" title="4.5 用户表增加其他账号"></a>4.5 用户表增加其他账号</h4><ol>
<li>用户表SYS_USER增加OTHER_LOGIN_NAME字段</li>
<li>SysUserMapper.xml语句增加otherLoginName字段</li>
<li>SysUser实体类增加otherLoginName属性和get&#x2F;set方法</li>
<li>template&#x2F;user&#x2F;edit.hml和add.html增加otherLoginName表单控件，user.html表单渲染增加otherLoginName字段</li>
<li><img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/8be3453c-7226-4727-8ae5-c3d6c6c563b4.png" alt="img" style="zoom:67%;" /></li>
</ol>
<h4 id="4-6-字典管理"><a href="#4-6-字典管理" class="headerlink" title="4.6 字典管理"></a>4.6 字典管理</h4><p>在站点管理中，站点状态（status）和站点类型（site_type）两个属性可以关联到数据字典。</p>
<p>切换到字典管理页面，点击<strong>新增sys_site_status数据字典</strong>：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/341fe0d0-033b-4046-834e-2f7e62d4be99.png" alt="img" style="zoom:67%;" />

<p>然后点击站点状态字典单元格右侧<strong>列表数据</strong>，新增字典数据，字典键值0对应站点启用状态，键值1对应站点停用状态：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/fff8a076-706d-490a-807d-29586e551b95.png" alt="img" style="zoom: 67%;" />

<img src="C:/Users/Document/WizNote/temp/7f20dc9c-3687-4b28-ae01-f55e40d54547/128/index_files/331ebd6f-2f62-4f62-8d51-eec83d950c60.png" alt="img" style="zoom:67%;" />

<p>然后在项目template的site&#x2F;add.html中站点状态对应表单控件中指定类型为数据字典sys_site_status：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span>站点状态：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:each</span>=<span class="string">&quot;dict : $&#123;@dict.getType(&#x27;sys_site_status&#x27;)&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">th:id</span>=<span class="string">&quot;$&#123;dict.dictCode&#125;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;status&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;dict.dictValue&#125;&quot;</span> <span class="attr">th:title</span>=<span class="string">&quot;$&#123;dict.dictLabel&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同样的，在edit.html中站点状态修改为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-item&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;layui-form-label&quot;</span>&gt;</span>站点状态：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-input-block&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:each</span>=<span class="string">&quot;dict : $&#123;@dict.getType(&#x27;sys_site_status&#x27;)&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">th:id</span>=<span class="string">&quot;$&#123;dict.dictCode&#125;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;status&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;dict.dictValue&#125;&quot;</span> <span class="attr">th:title</span>=<span class="string">&quot;$&#123;dict.dictLabel&#125;&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;status&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样在表单显示、新增、编辑时，站点状态显示为启用或停用两种状态：</p>
<p><img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/1eca7bdc-d2af-4a4c-a635-ec0ffbdc2799.png" alt="img" style="zoom: 80%;" /><img src="C:/Users/Document/WizNote/temp/7f20dc9c-3687-4b28-ae01-f55e40d54547/128/index_files/89118fff-3772-4c1d-b42f-de8bd1a5f29b.png" alt="img" style="zoom:67%;" /></p>
<p>同样的，为站点类型添加数据字典：<strong>sys_site_type</strong></p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/f468230d-7975-468e-a04a-cc7572c53175.png" alt="img" style="zoom:67%;" />

<p> 增加部门类型数据字典：<strong>sys_dept_type</strong></p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/7be2f294-5c42-4d53-8600-d6e770b5e494.png" alt="img" style="zoom:67%;" />

<p>增加部门等级数据字典：<strong>sys_dept_level</strong></p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/c3d1c9a5-6568-4688-a4c5-d6afe1d0955f.png" alt="img" style="zoom:67%;" />

<p>增加角色类型数据字典： </p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/367d2cfd-0f1d-46bf-bd5e-7d9525c4be66.png" alt="img" style="zoom:67%;" />

<h4 id="4-7-删除若依相关"><a href="#4-7-删除若依相关" class="headerlink" title="4.7 删除若依相关"></a>4.7 删除若依相关</h4><ul>
<li>点击菜单管理，找到“<strong>若依官网</strong>”菜单，编辑-隐藏；</li>
<li>定位到template&#x2F;inc&#x2F;top.html页面，修改Ruoyi-Layui站点名称；</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/7a00f2ba-4490-4103-8f75-dcba20060119.png" alt="img" style="zoom:67%;" />

<ul>
<li>定位到templates&#x2F;js&#x2F;index.js在添加tab方法addTab()末尾添加以下代码，解决Tab点击无法切换问题：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 解决Tab无法切换</span></span><br><span class="line">$(<span class="string">&#x27;#tabs_content .tabsbody-item&#x27;</span>).<span class="title function_">removeClass</span>(<span class="string">&#x27;layui-show&#x27;</span>);</span><br><span class="line">$(<span class="string">&#x27;#tabs_content iframe[data-id=&quot;&#x27;</span> + id + <span class="string">&#x27;&quot;]&#x27;</span>).<span class="title function_">parent</span>().<span class="title function_">addClass</span>(<span class="string">&#x27;layui-show&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>隐藏<strong>表单构建</strong>菜单；</li>
<li>修改<strong>README.md</strong>说明文档。</li>
</ul>
<h4 id="4-8-增加首页内容"><a href="#4-8-增加首页内容" class="headerlink" title="4.8 增加首页内容"></a>4.8 增加首页内容</h4><p>登录后进入首页，默认没有切换Tab标签，首页显示内容为空。定位到index.html的layui-body容器下，增加类名为welcome的子容器。</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/878c65df-d21c-4b4f-a9f6-eab39f02a0aa.png" alt="img" style="zoom:67%;" />

<h3 id="五、适配IE8"><a href="#五、适配IE8" class="headerlink" title="五、适配IE8"></a>五、适配IE8</h3><p>（云飞工作部分…）</p>
<h4 id="5-1-用户管理适配栅格布局"><a href="#5-1-用户管理适配栅格布局" class="headerlink" title="5.1 用户管理适配栅格布局"></a>5.1 用户管理适配栅格布局</h4><p>左侧部门展开树用到扩展模块eleTree.js，对代码中的forEach进行for i 循环转换；</p>
<p>定位到user.html。cdn引用两个js文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://cdn.staticfile.org/html5shiv/r29/html5.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>下载到本地进行引用：在js目录下新建 html5.min.js 和 respond.min.js，在user.html头部引用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script <span class="attr">th</span>:src=<span class="string">&quot;@&#123;/js/html5.min.js&#125;&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/js/respond.min.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>用户管理页面兼容成功：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/88870cf9-7059-4078-8bb0-cace5a46c9d8.png" alt="img" style="zoom:67%;" />

<h4 id="5-2-菜单部门页面树表"><a href="#5-2-菜单部门页面树表" class="headerlink" title="5.2 菜单部门页面树表"></a>5.2 菜单部门页面树表</h4><p><del>用到扩展模块treeTable.js，使用可以兼容IE8浏览器树形展开表格的扩展组件treeTable：</del></p>
<p>~~代码地址：<a target="_blank" rel="noopener" href="https://fly.layui.com/extend/treeTable/">https://fly.layui.com/extend/treeTable/</a><br>~~</p>
<p><del>将原来的treeTable模块替换为该模块，并做相应的兼容性修改。</del></p>
<ul>
<li>JSON.stringify()等不支持</li>
</ul>
<p>IE8没有JSON函数，手动添加json2.js到js目录下，下载地址：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/douglascrockford/JSON-js/edit/master/json2.js">https://github.com/douglascrockford/JSON-js/edit/master/json2.js</a></p>
<p>然后在dept.html和menu.html页面table.render()之前添加：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 增加<span class="title class_">IE8</span>对<span class="title class_">JSON</span>的兼容 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/js/json2.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>forEach()语法不支持</li>
</ul>
<p>在treeTable.js代码前面添加forEach转for循环：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">forEach</span>) &#123;</span><br><span class="line">   <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">forEach</span> = <span class="keyword">function</span> <span class="title function_">forEach</span>(<span class="params">callback, thisArg</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> T, k;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;this is null or not defined&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">var</span> O = <span class="title class_">Object</span>(<span class="variable language_">this</span>);</span><br><span class="line">      <span class="keyword">var</span> len = O.<span class="property">length</span> &gt;&gt;&gt; <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> callback !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(callback + <span class="string">&quot; is not a function&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">         T = thisArg;</span><br><span class="line">      &#125;</span><br><span class="line">      k = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (k &lt; len) &#123;</span><br><span class="line">         <span class="keyword">var</span> kValue;</span><br><span class="line">         <span class="keyword">if</span> (k <span class="keyword">in</span> O) &#123;</span><br><span class="line">            kValue = O[k];</span><br><span class="line">            callback.<span class="title function_">call</span>(T, kValue, k, O);</span><br><span class="line">         &#125;</span><br><span class="line">         k++;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>树表高度坍缩</li>
</ul>
<p>经过以上两步处理后，IE8浏览器中菜单部门两个页面的数表结构不再报错，数据成功渲染，但是高度只有一行单元格的高度：</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/5f22220c-5ecf-4c93-9cb2-e4104256dba7.png" alt="img" style="zoom:67%;" />

<p>在表格渲染内设置height属性，这里暂时设置为固定高度500px，后续再做优化。</p>
<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/960a1fed-0ccf-4e9e-b8e3-692cfb81dc95.png" alt="img" style="zoom:67%;" />

<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/image-20211019165423943.png" alt="image-20211019165423943" style="zoom:67%;" />

<p>至此，兼容IE8的主要问题基本解决。</p>
<h3 id="六、工作进度"><a href="#六、工作进度" class="headerlink" title="六、工作进度"></a>六、工作进度</h3><p>项目地址：<a target="_blank" rel="noopener" href="https://gitee.com/juaran/ruoyi-oracl-layui">https://gitee.com/juaran/ruoyi-oracl-layui</a></p>
<p>完成功能（截止2021&#x2F;01&#x2F;17）:</p>
<ol>
<li>若依Layui前端页面移植到若依Oracle版本</li>
<li>树形表格兼容IE8浏览器</li>
<li>按照需求增加了站点管理菜单和CRUD、部门管理增加部门类型和部门等级属性</li>
</ol>
<p>未完成功能：</p>
<ul>
<li>人员部门岗位关系（涛哥接管）</li>
<li>人员表增加绑定账号属性、岗位表增加站点ID属性、角色表增加站点ID和角色类型属性（未涉及其他关联关系，按照部门添加属性的方法即可完成）</li>
<li>岗位角色关系表（需要参照已有角色部门表ROLE_DEPT的实现）</li>
</ul>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2021/01/05/2021-01-05-%E3%80%90%E7%A0%94%E4%B8%80%E4%B8%8A%E3%80%91%E7%AC%AC%E5%8D%81%E4%B9%9D%E5%91%A8%E5%AD%A6%E4%B9%A0%E6%B1%87%E6%8A%A5/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>上一页</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="更新时间"></i>
              2021-01-16 16:00:00
            </span>
            
                  <span class="post-categories">
                    <i class="iconfont icon-bookmark" title="分类"></i>
                    
                    <span class="span--category">
                      <a href="/categories/project/" title="project">
                        <b>#</b> project
                      </a>
                    </span>
                    
                  </span>
              
                  <span class="post-tags">
                    <i class="iconfont icon-tags" title="标签"></i>
                    
                    <span class="span--tag">
                      <a href="/tags/%E5%91%A8%E6%8A%A5/" title="周报">
                        <b>#</b> 周报
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/2021/03/12/2021-03-12-%E3%80%90%E7%A0%94%E4%B8%80%E4%B8%8B%E3%80%91%E7%AC%AC%E4%BA%8C%E5%91%A8%E5%AD%A6%E4%B9%A0/" target="_self">
                <span>下一页</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">目录</div>
    <div class="catalog-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%9B%AE%E6%A0%87"><span class="toc-text">项目目标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E5%9C%B0%E5%9D%80"><span class="toc-text">一、项目地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Oracle%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">二、Oracle数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker%E5%AE%89%E8%A3%85Oracle"><span class="toc-text">Docker安装Oracle</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%A1%B5%E9%9D%A2%E7%A7%BB%E6%A4%8D"><span class="toc-text">三、页面移植</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-text">3.1 配置数据源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E6%9B%BF%E6%8D%A2%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-text">3.2 替换前端页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-text">3.3 用户管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E8%A7%92%E8%89%B2%E7%AE%A1%E7%90%86"><span class="toc-text">3.4 角色管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E8%8F%9C%E5%8D%95%E7%AE%A1%E7%90%86"><span class="toc-text">3.5 菜单管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86"><span class="toc-text">3.6 部门管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-%E5%85%B6%E4%BD%99%E9%A1%B5%E9%9D%A2"><span class="toc-text">3.7 其余页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%96%B0%E5%A2%9E%E5%8A%9F%E8%83%BD"><span class="toc-text">四、新增功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E6%96%B0%E5%A2%9E%E7%AB%99%E7%82%B9"><span class="toc-text">4.1 新增站点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E9%83%A8%E9%97%A8%E8%A1%A8%E5%A2%9E%E5%8A%A0%E7%B1%BB%E5%9E%8B%E7%AD%89%E7%BA%A7"><span class="toc-text">4.2 部门表增加类型等级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E8%A7%92%E8%89%B2%E8%A1%A8%E5%A2%9E%E5%8A%A0%E8%A7%92%E8%89%B2%E7%B1%BB%E5%9E%8B"><span class="toc-text">4.3 角色表增加角色类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-%E5%B2%97%E4%BD%8D%E8%A1%A8%E5%A2%9E%E5%8A%A0%E7%AB%99%E7%82%B9ID"><span class="toc-text">4.4 岗位表增加站点ID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-%E7%94%A8%E6%88%B7%E8%A1%A8%E5%A2%9E%E5%8A%A0%E5%85%B6%E4%BB%96%E8%B4%A6%E5%8F%B7"><span class="toc-text">4.5 用户表增加其他账号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6-%E5%AD%97%E5%85%B8%E7%AE%A1%E7%90%86"><span class="toc-text">4.6 字典管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7-%E5%88%A0%E9%99%A4%E8%8B%A5%E4%BE%9D%E7%9B%B8%E5%85%B3"><span class="toc-text">4.7 删除若依相关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-%E5%A2%9E%E5%8A%A0%E9%A6%96%E9%A1%B5%E5%86%85%E5%AE%B9"><span class="toc-text">4.8 增加首页内容</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E9%80%82%E9%85%8DIE8"><span class="toc-text">五、适配IE8</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E9%80%82%E9%85%8D%E6%A0%85%E6%A0%BC%E5%B8%83%E5%B1%80"><span class="toc-text">5.1 用户管理适配栅格布局</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E8%8F%9C%E5%8D%95%E9%83%A8%E9%97%A8%E9%A1%B5%E9%9D%A2%E6%A0%91%E8%A1%A8"><span class="toc-text">5.2 菜单部门页面树表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%B7%A5%E4%BD%9C%E8%BF%9B%E5%BA%A6"><span class="toc-text">六、工作进度</span></a></li></ol></li></ol>
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        






  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

  <div id="gitalk-container"></div>

  <script>
    const gitalk = new Gitalk({
      clientID: '5701baa041ba27d28c94',
      clientSecret: '87f7280a5901e8c3d5f84bd9ee65f993bdf43640',
      repo: 'juaran.github.io',
      owner: 'Juaran',
      admin: ['Juaran'],
      id: decodeURI(location.pathname),
      distractionFreeMode: false
    })

    gitalk.render('gitalk-container')
  </script>


      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/juaran">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/juaran">Copyright © 2022 Vic2ray</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        


        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        

      </div>
    </div>
  </body>
</html>
