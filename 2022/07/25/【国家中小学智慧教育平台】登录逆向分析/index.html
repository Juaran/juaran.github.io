<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="Vic2ray" />
  <meta name="description" content="" />
  
  
  <title>
    
      【国家中小学智慧教育平台】登录逆向分析 
      
      
      |
    
     Vic2ray&#39;s Blog
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/color-scheme.css">
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/comments.css">


  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>

<meta name="generator" content="Hexo 6.1.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">Vic2ray</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">主页</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">归档</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">分类</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">标签</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">关于</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->

<!-- LaTex Display -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>



  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">【国家中小学智慧教育平台】登录逆向分析</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="更新时间"></i>
          2022-07-25 10:00:11
        </span>
        
              <span class="post-tags">
                <i class="iconfont icon-tags" title="标签"></i>
                
                <span class="span--tag">
                  <a href="/tags/js%E9%80%86%E5%90%91/" title="js逆向">
                    <b>#</b> js逆向
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <h2 id="网址"><a href="#网址" class="headerlink" title="网址"></a>网址</h2><p>主页：<a target="_blank" rel="noopener" href="https://www.zxx.edu.cn/">https://www.zxx.edu.cn/</a></p>
<p>登录页：<a target="_blank" rel="noopener" href="https://www.zxx.edu.cn/uc?sdp-app-id=e5649925-441d-4a53-b525-51a2f1c4e0a8&redirect_uri=https://www.zxx.edu.cn/&send_uckey=true&re_login=false#/login">主页点击登录后跳转</a></p>
<h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><p>打开Chrome控制台，点击登录，主要有tokens和sessions两个登录相关请求。</p>
<h2 id="tokens"><a href="#tokens" class="headerlink" title="tokens"></a>tokens</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// XHR</span></span><br><span class="line">https<span class="punctuation">:</span><span class="comment">//uc-gateway.ykt.eduyun.cn/v1.1/tokens</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Request Payloads</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;session_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;fb6415e7-7c24-4bdc-9c20-63ad559c636a&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;login_name&quot;</span><span class="punctuation">:</span><span class="string">&quot;QyuZxQzriIw=&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;t3qwTIiA52m4X2cKIlVIqqIJb4GxKXobk4QiTzYb3bZxrnYtqNcymw==&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Response - 400</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;host_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;uc-gateway.ykt.eduyun.cn&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;request_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;uc-gateway-172.16.1.166^1658675894783^13325&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;server_time&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-07-25T14:23:36.294+08:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="string">&quot;UC/PASSWORD_NOT_CORRECT&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户名或密码错误&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// Response - 201</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;account_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;account_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;x&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;access_token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;x&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;refresh_token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;x&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;mac_algorithm&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hmac-sha-256&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;mac_key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;x&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;expires_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-08-01T14:34:10.865+0800&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;server_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-07-25T14:34:10.872+0800&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;region&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wx&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;source_token_account_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;person&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;login_name_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mobile&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;password_change_regularly_claim&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;weak_pwd&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这是一个Content-Type为<code>application/json</code>的POST跨域请求。加密字段只有用户名和密码。</p>
<h2 id="sessions"><a href="#sessions" class="headerlink" title="sessions"></a>sessions</h2><p>在所有网络请求中搜索<code>session_id</code>，发现第一次出现在tokens前发出的请求sessions：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// XHR</span></span><br><span class="line">https<span class="punctuation">:</span><span class="comment">//uc-gateway.ykt.eduyun.cn/v1.1/sessions</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Request Payloads</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;device_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;dwWin7/Chrome100/03a2b204-f1c2-4243-a338-a1a9e881304a&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Response</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;session_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;155a8167-fd8c-46d0-b536-0ed9b53ee8c2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;session_key&quot;</span><span class="punctuation">:</span><span class="string">&quot;l26ZK0Oy&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;is_normal&quot;</span><span class="punctuation">:</span><span class="keyword">true</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>请求返回了<code>session_id</code>和<code>session_key</code>，用于标识不同客户端。</p>
<p>全局搜索<code>session_id</code>，找到AJAX请求代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">t.<span class="property">createSession</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> e = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">headerManager</span>.<span class="title function_">getDeviceID</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">t</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> e.<span class="property">request</span>.<span class="title function_">post</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;&quot;</span>.<span class="title function_">concat</span>(e.<span class="property">UC</span>, <span class="string">&quot;/v1.1/sessions&quot;</span>),</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="attr">device_id</span>: t</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可见<code>device_id</code>由函数<code>getDeviceID</code>生成。找到该函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> t.<span class="property">getDeviceID</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> e = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">fetchDeviceId</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">t</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!t) &#123;</span><br><span class="line">            <span class="keyword">var</span> n = <span class="string">&quot;&quot;</span>.<span class="title function_">concat</span>(<span class="title class_">Object</span>(u.<span class="property">c</span>)(<span class="string">&quot;/&quot;</span>), <span class="string">&quot;/&quot;</span>).<span class="title function_">concat</span>(<span class="title class_">Object</span>(c.<span class="property">a</span>)());</span><br><span class="line">            t = <span class="string">&quot;&quot;</span>.<span class="title function_">concat</span>(<span class="title class_">Object</span>(u.<span class="property">b</span>)(n), <span class="string">&quot;w&quot;</span>).<span class="title function_">concat</span>(n)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> e.<span class="property">storage</span>.<span class="title function_">set</span>(d.<span class="property">d</span>, t),</span><br><span class="line">        t</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此函数的逻辑是，调用<code>fetchDeviceId</code>，如果结果非空则在本地<code>storage.set</code>存储，为空则生成后存储。我们查看浏览器本地存储，发现存在以下键值：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ND_UC_DEVICE_ID<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="string">&quot;dwWin7/Chrome100/03a2b204-f1c2-4243-a338-a1a9e881304a&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>其值正是session请求中的device_id。查看fetchDeviceId函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">t.<span class="property">fetchDeviceId</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> e = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">deviceId</span> ? <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">deviceId</span>) : <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">mode</span> === d.<span class="property">f</span>.<span class="property">APPFACTORY</span> ? f.<span class="property">a</span>.<span class="title function_">getDeviceId</span>().<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> e.<span class="property">storage</span>.<span class="title function_">get</span>(d.<span class="property">d</span>)</span><br><span class="line">    &#125;) : <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">storage</span>.<span class="title function_">get</span>(d.<span class="property">d</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主要逻辑是<code>storage.get</code>获取已有的device_id。那么我们只需要关注其生成逻辑。</p>
<h2 id="device-id"><a href="#device-id" class="headerlink" title="device_id"></a>device_id</h2><p>前文我们已经找到了当本地没有存储device_id时的生成代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!t) &#123;</span><br><span class="line">    <span class="keyword">var</span> n = <span class="string">&quot;&quot;</span>.<span class="title function_">concat</span>(<span class="title class_">Object</span>(u.<span class="property">c</span>)(<span class="string">&quot;/&quot;</span>), <span class="string">&quot;/&quot;</span>).<span class="title function_">concat</span>(<span class="title class_">Object</span>(c.<span class="property">a</span>)());</span><br><span class="line">    t = <span class="string">&quot;&quot;</span>.<span class="title function_">concat</span>(<span class="title class_">Object</span>(u.<span class="property">b</span>)(n), <span class="string">&quot;w&quot;</span>).<span class="title function_">concat</span>(n)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一共分为两个字符串拼接过程。我们在此处断点，以更好的观察值。同时对照已经生成的值进行快速推断<code>dwWin7/Chrome100/03a2b204-f1c2-4243-a338-a1a9e881304a</code>。</p>
<p>第一个过程：<code>Object(u.c)(&quot;/&quot;)</code>将产生字符串<code>Win7/Chrome100</code>，随后连接<code>/</code>，<code>Object(c.a)()</code>是类似uuid的32位随机值。</p>
<p>第二个过程，将以上产生的结果传入<code>Object(u.b)(n)</code>得到单个字符<code>d</code>，再拼接<code>w</code>，最后再拼接上一步结果。</p>
<p>为了验证以上推断，先将本地存储值清除，断点并在控制台输出查看相关函数。首先是<code>u.c</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">r</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;undefined&quot;</span> == <span class="keyword">typeof</span> navigator)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;unknown&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> t = navigator.<span class="property">platform</span></span><br><span class="line">            , n = navigator.<span class="property">userAgent</span></span><br><span class="line">            , r = <span class="string">&quot;&quot;</span></span><br><span class="line">            , a = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> t.<span class="title function_">indexOf</span>(<span class="string">&quot;Win&quot;</span>) &gt; -<span class="number">1</span> ? n.<span class="title function_">indexOf</span>(<span class="string">&quot;Windows NT 5.0&quot;</span>) &gt; -<span class="number">1</span> ? r += <span class="string">&quot;Win2000&quot;</span> : n.<span class="title function_">indexOf</span>(<span class="string">&quot;Windows NT 5.1&quot;</span>) &gt; -<span class="number">1</span> ? r += <span class="string">&quot;WinXP&quot;</span> : n.<span class="title function_">indexOf</span>(<span class="string">&quot;Windows NT 5.2&quot;</span>) &gt; -<span class="number">1</span> ? r += <span class="string">&quot;Win2003&quot;</span> : n.<span class="title function_">indexOf</span>(<span class="string">&quot;Windows NT 6.0&quot;</span>) &gt; -<span class="number">1</span> ? r += <span class="string">&quot;WindowsVista&quot;</span> : n.<span class="title function_">indexOf</span>(<span class="string">&quot;Windows NT 6.1&quot;</span>) &gt; -<span class="number">1</span> ? r += <span class="string">&quot;Win7&quot;</span> : n.<span class="title function_">indexOf</span>(<span class="string">&quot;Windows NT 6.2&quot;</span>) &gt; -<span class="number">1</span> ? r += <span class="string">&quot;Win8&quot;</span> : n.<span class="title function_">indexOf</span>(<span class="string">&quot;Windows NT 6.3&quot;</span>) &gt; -<span class="number">1</span> ? r += <span class="string">&quot;Win8.1&quot;</span> : n.<span class="title function_">indexOf</span>(<span class="string">&quot;Windows NT 6.4&quot;</span>) &gt; -<span class="number">1</span> || n.<span class="title function_">indexOf</span>(<span class="string">&quot;Windows NT 10.0&quot;</span>) &gt; -<span class="number">1</span> ? r += <span class="string">&quot;Win10&quot;</span> : r += <span class="string">&quot;Other&quot;</span> : t.<span class="title function_">indexOf</span>(<span class="string">&quot;Mac&quot;</span>) &gt; -<span class="number">1</span> ? r += <span class="string">&quot;Mac&quot;</span> : t.<span class="title function_">indexOf</span>(<span class="string">&quot;X11&quot;</span>) &gt; -<span class="number">1</span> ? r += <span class="string">&quot;Unix&quot;</span> : t.<span class="title function_">indexOf</span>(<span class="string">&quot;Linux&quot;</span>) &gt; -<span class="number">1</span> ? r += <span class="string">&quot;Linux&quot;</span> : r += <span class="string">&quot;Other&quot;</span>,</span><br><span class="line">        r += e,</span><br><span class="line">        <span class="regexp">/[Ff]irefox(\/\d+\.\d+)/</span>.<span class="title function_">test</span>(n) ? (a = <span class="regexp">/([Ff]irefox)\/(\d+\.\d+)/</span>.<span class="title function_">exec</span>(n),</span><br><span class="line">        r += a[<span class="number">1</span>] + a[<span class="number">2</span>]) : <span class="regexp">/MSIE \d+\.\d+/</span>.<span class="title function_">test</span>(n) ? (a = <span class="regexp">/MS(IE) (\d+\.\d+)/</span>.<span class="title function_">exec</span>(n),</span><br><span class="line">        r += a[<span class="number">1</span>] + a[<span class="number">2</span>]) : <span class="regexp">/[Cc]hrome\/\d+/</span>.<span class="title function_">test</span>(n) ? (a = <span class="regexp">/([Cc]hrome)\/(\d+)/</span>.<span class="title function_">exec</span>(n),</span><br><span class="line">        r += a[<span class="number">1</span>] + a[<span class="number">2</span>]) : <span class="regexp">/[Vv]ersion\/\d+\.\d+\.\d+(\.\d)* *[Ss]afari/</span>.<span class="title function_">test</span>(n) ? (a = <span class="regexp">/[Vv]ersion\/(\d+\.\d+\.\d+)(\.\d)* *([Ss]afari)/</span>.<span class="title function_">exec</span>(n),</span><br><span class="line">        r += a[<span class="number">3</span>] + a[<span class="number">1</span>]) : <span class="regexp">/[Oo]pera.+[Vv]ersion\/\d+\.\d+/</span>.<span class="title function_">test</span>(n) ? (a = <span class="regexp">/([Oo]pera).+[Vv]ersion\/(\d+)\.\d+/</span>.<span class="title function_">exec</span>(n),</span><br><span class="line">        r += a[<span class="number">1</span>] + a[<span class="number">2</span>]) : r += <span class="string">&quot;unknown&quot;</span>,</span><br><span class="line">        r.<span class="title function_">indexOf</span>(<span class="string">&quot;IE&quot;</span>) &gt; -<span class="number">1</span> ? <span class="string">&quot;windows_IE&quot;</span> : r</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">return</span> l.<span class="property">a</span>.<span class="title function_">warn</span>(<span class="string">&quot;获取系统名和浏览器名失败&quot;</span>, e),</span><br><span class="line">        <span class="string">&quot;unknown&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主要根据<code>navigator.platform</code>和<code>navigator.userAgent</code>获取操作系统和浏览器信息，中间过程整挺复杂，不过对我们来说就固定它是<code>Win7/Chrome100</code>就行了。再看<code>c.a</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">r</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx&quot;</span>.<span class="title function_">replace</span>(<span class="regexp">/[xy]/g</span>, <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> t = <span class="number">16</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>() | <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;x&quot;</span> === e ? t : <span class="number">3</span> &amp; t | <span class="number">8</span>).<span class="title function_">toString</span>(<span class="number">16</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自定义的uuid生成规则，中间有个4是固定不变的，<code>x</code>的值是<code>t</code>，0-15之间的随机整数（或运算|快速取整），<code>y</code>取值多了一点运算。这个函数需要原样抠出来。</p>
<p>再看第二个拼接过程的函数<code>u.b</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">o</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> u.<span class="property">a</span>.<span class="title function_">encoder</span>(<span class="title function_">s</span>()(e, c.<span class="property">h</span>)).<span class="title function_">charAt</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此处再断点。在控制台打印<code>c.h</code>为固定字符串<code>£¬¡£fdjf,jkgfkl</code>，<code>s()</code>如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">e.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">e, t</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">d</span>(e + (t || <span class="string">&quot;&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>即拼接两个字符串，再由<code>d</code>处理返回。<code>d</code>正好在这个函数上面定义，把这部分完整抠下来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">, <span class="keyword">function</span>(<span class="params">e, t, n</span>) &#123;</span><br><span class="line">    <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">r</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> t = <span class="string">&quot;&quot;</span>, n = <span class="number">0</span>; n &lt;= <span class="number">3</span>; n++)</span><br><span class="line">            t += p.<span class="title function_">charAt</span>(e &gt;&gt; <span class="number">8</span> * n + <span class="number">4</span> &amp; <span class="number">15</span>) + p.<span class="title function_">charAt</span>(e &gt;&gt; <span class="number">8</span> * n &amp; <span class="number">15</span>);</span><br><span class="line">        <span class="keyword">return</span> t</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">o</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> t, n = <span class="number">1</span> + (e.<span class="property">length</span> + <span class="number">8</span> &gt;&gt; <span class="number">6</span>), r = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">16</span> * n);</span><br><span class="line">        <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; <span class="number">16</span> * n; t++)</span><br><span class="line">            r[t] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; e.<span class="property">length</span>; t++)</span><br><span class="line">            r[t &gt;&gt; <span class="number">2</span>] |= e.<span class="title function_">charCodeAt</span>(t) &lt;&lt; t % <span class="number">4</span> * <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">return</span> r[t &gt;&gt; <span class="number">2</span>] |= <span class="number">128</span> &lt;&lt; t % <span class="number">4</span> * <span class="number">8</span>,</span><br><span class="line">        r[<span class="number">16</span> * n - <span class="number">2</span>] = <span class="number">8</span> * e.<span class="property">length</span>,</span><br><span class="line">        r</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">i</span>(<span class="params">e, t</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> n = (<span class="number">65535</span> &amp; e) + (<span class="number">65535</span> &amp; t);</span><br><span class="line">        <span class="keyword">return</span> (e &gt;&gt; <span class="number">16</span>) + (t &gt;&gt; <span class="number">16</span>) + (n &gt;&gt; <span class="number">16</span>) &lt;&lt; <span class="number">16</span> | <span class="number">65535</span> &amp; n</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">a</span>(<span class="params">e, t</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> e &lt;&lt; t | e &gt;&gt;&gt; <span class="number">32</span> - t</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">s</span>(<span class="params">e, t, n, r, o, s</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">i</span>(<span class="title function_">a</span>(<span class="title function_">i</span>(<span class="title function_">i</span>(t, e), <span class="title function_">i</span>(r, s)), o), n)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">l</span>(<span class="params">e, t, n, r, o, i, a</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">s</span>(t &amp; n | ~t &amp; r, e, t, o, i, a)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">u</span>(<span class="params">e, t, n, r, o, i, a</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">s</span>(t &amp; r | n &amp; ~r, e, t, o, i, a)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">c</span>(<span class="params">e, t, n, r, o, i, a</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">s</span>(t ^ n ^ r, e, t, o, i, a)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">f</span>(<span class="params">e, t, n, r, o, i, a</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">s</span>(n ^ (t | ~r), e, t, o, i, a)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">d</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> t = <span class="title function_">o</span>(e), n = <span class="number">1732584193</span>, a = -<span class="number">271733879</span>, s = -<span class="number">1732584194</span>, d = <span class="number">271733878</span>, p = <span class="number">0</span>; p &lt; t.<span class="property">length</span>; p += <span class="number">16</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> h = n</span><br><span class="line">              , v = a</span><br><span class="line">              , m = s</span><br><span class="line">              , y = d;</span><br><span class="line">            n = <span class="title function_">l</span>(n, a, s, d, t[p + <span class="number">0</span>], <span class="number">7</span>, -<span class="number">680876936</span>),</span><br><span class="line">            d = <span class="title function_">l</span>(d, n, a, s, t[p + <span class="number">1</span>], <span class="number">12</span>, -<span class="number">389564586</span>),</span><br><span class="line">            s = <span class="title function_">l</span>(s, d, n, a, t[p + <span class="number">2</span>], <span class="number">17</span>, <span class="number">606105819</span>),</span><br><span class="line">            a = <span class="title function_">l</span>(a, s, d, n, t[p + <span class="number">3</span>], <span class="number">22</span>, -<span class="number">1044525330</span>),</span><br><span class="line">            n = <span class="title function_">l</span>(n, a, s, d, t[p + <span class="number">4</span>], <span class="number">7</span>, -<span class="number">176418897</span>),</span><br><span class="line">            d = <span class="title function_">l</span>(d, n, a, s, t[p + <span class="number">5</span>], <span class="number">12</span>, <span class="number">1200080426</span>),</span><br><span class="line">            s = <span class="title function_">l</span>(s, d, n, a, t[p + <span class="number">6</span>], <span class="number">17</span>, -<span class="number">1473231341</span>),</span><br><span class="line">            a = <span class="title function_">l</span>(a, s, d, n, t[p + <span class="number">7</span>], <span class="number">22</span>, -<span class="number">45705983</span>),</span><br><span class="line">            n = <span class="title function_">l</span>(n, a, s, d, t[p + <span class="number">8</span>], <span class="number">7</span>, <span class="number">1770035416</span>),</span><br><span class="line">            d = <span class="title function_">l</span>(d, n, a, s, t[p + <span class="number">9</span>], <span class="number">12</span>, -<span class="number">1958414417</span>),</span><br><span class="line">            s = <span class="title function_">l</span>(s, d, n, a, t[p + <span class="number">10</span>], <span class="number">17</span>, -<span class="number">42063</span>),</span><br><span class="line">            a = <span class="title function_">l</span>(a, s, d, n, t[p + <span class="number">11</span>], <span class="number">22</span>, -<span class="number">1990404162</span>),</span><br><span class="line">            n = <span class="title function_">l</span>(n, a, s, d, t[p + <span class="number">12</span>], <span class="number">7</span>, <span class="number">1804603682</span>),</span><br><span class="line">            d = <span class="title function_">l</span>(d, n, a, s, t[p + <span class="number">13</span>], <span class="number">12</span>, -<span class="number">40341101</span>),</span><br><span class="line">            s = <span class="title function_">l</span>(s, d, n, a, t[p + <span class="number">14</span>], <span class="number">17</span>, -<span class="number">1502002290</span>),</span><br><span class="line">            a = <span class="title function_">l</span>(a, s, d, n, t[p + <span class="number">15</span>], <span class="number">22</span>, <span class="number">1236535329</span>),</span><br><span class="line">            n = <span class="title function_">u</span>(n, a, s, d, t[p + <span class="number">1</span>], <span class="number">5</span>, -<span class="number">165796510</span>),</span><br><span class="line">            d = <span class="title function_">u</span>(d, n, a, s, t[p + <span class="number">6</span>], <span class="number">9</span>, -<span class="number">1069501632</span>),</span><br><span class="line">            s = <span class="title function_">u</span>(s, d, n, a, t[p + <span class="number">11</span>], <span class="number">14</span>, <span class="number">643717713</span>),</span><br><span class="line">            a = <span class="title function_">u</span>(a, s, d, n, t[p + <span class="number">0</span>], <span class="number">20</span>, -<span class="number">373897302</span>),</span><br><span class="line">            n = <span class="title function_">u</span>(n, a, s, d, t[p + <span class="number">5</span>], <span class="number">5</span>, -<span class="number">701558691</span>),</span><br><span class="line">            d = <span class="title function_">u</span>(d, n, a, s, t[p + <span class="number">10</span>], <span class="number">9</span>, <span class="number">38016083</span>),</span><br><span class="line">            s = <span class="title function_">u</span>(s, d, n, a, t[p + <span class="number">15</span>], <span class="number">14</span>, -<span class="number">660478335</span>),</span><br><span class="line">            a = <span class="title function_">u</span>(a, s, d, n, t[p + <span class="number">4</span>], <span class="number">20</span>, -<span class="number">405537848</span>),</span><br><span class="line">            n = <span class="title function_">u</span>(n, a, s, d, t[p + <span class="number">9</span>], <span class="number">5</span>, <span class="number">568446438</span>),</span><br><span class="line">            d = <span class="title function_">u</span>(d, n, a, s, t[p + <span class="number">14</span>], <span class="number">9</span>, -<span class="number">1019803690</span>),</span><br><span class="line">            s = <span class="title function_">u</span>(s, d, n, a, t[p + <span class="number">3</span>], <span class="number">14</span>, -<span class="number">187363961</span>),</span><br><span class="line">            a = <span class="title function_">u</span>(a, s, d, n, t[p + <span class="number">8</span>], <span class="number">20</span>, <span class="number">1163531501</span>),</span><br><span class="line">            n = <span class="title function_">u</span>(n, a, s, d, t[p + <span class="number">13</span>], <span class="number">5</span>, -<span class="number">1444681467</span>),</span><br><span class="line">            d = <span class="title function_">u</span>(d, n, a, s, t[p + <span class="number">2</span>], <span class="number">9</span>, -<span class="number">51403784</span>),</span><br><span class="line">            s = <span class="title function_">u</span>(s, d, n, a, t[p + <span class="number">7</span>], <span class="number">14</span>, <span class="number">1735328473</span>),</span><br><span class="line">            a = <span class="title function_">u</span>(a, s, d, n, t[p + <span class="number">12</span>], <span class="number">20</span>, -<span class="number">1926607734</span>),</span><br><span class="line">            n = <span class="title function_">c</span>(n, a, s, d, t[p + <span class="number">5</span>], <span class="number">4</span>, -<span class="number">378558</span>),</span><br><span class="line">            d = <span class="title function_">c</span>(d, n, a, s, t[p + <span class="number">8</span>], <span class="number">11</span>, -<span class="number">2022574463</span>),</span><br><span class="line">            s = <span class="title function_">c</span>(s, d, n, a, t[p + <span class="number">11</span>], <span class="number">16</span>, <span class="number">1839030562</span>),</span><br><span class="line">            a = <span class="title function_">c</span>(a, s, d, n, t[p + <span class="number">14</span>], <span class="number">23</span>, -<span class="number">35309556</span>),</span><br><span class="line">            n = <span class="title function_">c</span>(n, a, s, d, t[p + <span class="number">1</span>], <span class="number">4</span>, -<span class="number">1530992060</span>),</span><br><span class="line">            d = <span class="title function_">c</span>(d, n, a, s, t[p + <span class="number">4</span>], <span class="number">11</span>, <span class="number">1272893353</span>),</span><br><span class="line">            s = <span class="title function_">c</span>(s, d, n, a, t[p + <span class="number">7</span>], <span class="number">16</span>, -<span class="number">155497632</span>),</span><br><span class="line">            a = <span class="title function_">c</span>(a, s, d, n, t[p + <span class="number">10</span>], <span class="number">23</span>, -<span class="number">1094730640</span>),</span><br><span class="line">            n = <span class="title function_">c</span>(n, a, s, d, t[p + <span class="number">13</span>], <span class="number">4</span>, <span class="number">681279174</span>),</span><br><span class="line">            d = <span class="title function_">c</span>(d, n, a, s, t[p + <span class="number">0</span>], <span class="number">11</span>, -<span class="number">358537222</span>),</span><br><span class="line">            s = <span class="title function_">c</span>(s, d, n, a, t[p + <span class="number">3</span>], <span class="number">16</span>, -<span class="number">722521979</span>),</span><br><span class="line">            a = <span class="title function_">c</span>(a, s, d, n, t[p + <span class="number">6</span>], <span class="number">23</span>, <span class="number">76029189</span>),</span><br><span class="line">            n = <span class="title function_">c</span>(n, a, s, d, t[p + <span class="number">9</span>], <span class="number">4</span>, -<span class="number">640364487</span>),</span><br><span class="line">            d = <span class="title function_">c</span>(d, n, a, s, t[p + <span class="number">12</span>], <span class="number">11</span>, -<span class="number">421815835</span>),</span><br><span class="line">            s = <span class="title function_">c</span>(s, d, n, a, t[p + <span class="number">15</span>], <span class="number">16</span>, <span class="number">530742520</span>),</span><br><span class="line">            a = <span class="title function_">c</span>(a, s, d, n, t[p + <span class="number">2</span>], <span class="number">23</span>, -<span class="number">995338651</span>),</span><br><span class="line">            n = <span class="title function_">f</span>(n, a, s, d, t[p + <span class="number">0</span>], <span class="number">6</span>, -<span class="number">198630844</span>),</span><br><span class="line">            d = <span class="title function_">f</span>(d, n, a, s, t[p + <span class="number">7</span>], <span class="number">10</span>, <span class="number">1126891415</span>),</span><br><span class="line">            s = <span class="title function_">f</span>(s, d, n, a, t[p + <span class="number">14</span>], <span class="number">15</span>, -<span class="number">1416354905</span>),</span><br><span class="line">            a = <span class="title function_">f</span>(a, s, d, n, t[p + <span class="number">5</span>], <span class="number">21</span>, -<span class="number">57434055</span>),</span><br><span class="line">            n = <span class="title function_">f</span>(n, a, s, d, t[p + <span class="number">12</span>], <span class="number">6</span>, <span class="number">1700485571</span>),</span><br><span class="line">            d = <span class="title function_">f</span>(d, n, a, s, t[p + <span class="number">3</span>], <span class="number">10</span>, -<span class="number">1894986606</span>),</span><br><span class="line">            s = <span class="title function_">f</span>(s, d, n, a, t[p + <span class="number">10</span>], <span class="number">15</span>, -<span class="number">1051523</span>),</span><br><span class="line">            a = <span class="title function_">f</span>(a, s, d, n, t[p + <span class="number">1</span>], <span class="number">21</span>, -<span class="number">2054922799</span>),</span><br><span class="line">            n = <span class="title function_">f</span>(n, a, s, d, t[p + <span class="number">8</span>], <span class="number">6</span>, <span class="number">1873313359</span>),</span><br><span class="line">            d = <span class="title function_">f</span>(d, n, a, s, t[p + <span class="number">15</span>], <span class="number">10</span>, -<span class="number">30611744</span>),</span><br><span class="line">            s = <span class="title function_">f</span>(s, d, n, a, t[p + <span class="number">6</span>], <span class="number">15</span>, -<span class="number">1560198380</span>),</span><br><span class="line">            a = <span class="title function_">f</span>(a, s, d, n, t[p + <span class="number">13</span>], <span class="number">21</span>, <span class="number">1309151649</span>),</span><br><span class="line">            n = <span class="title function_">f</span>(n, a, s, d, t[p + <span class="number">4</span>], <span class="number">6</span>, -<span class="number">145523070</span>),</span><br><span class="line">            d = <span class="title function_">f</span>(d, n, a, s, t[p + <span class="number">11</span>], <span class="number">10</span>, -<span class="number">1120210379</span>),</span><br><span class="line">            s = <span class="title function_">f</span>(s, d, n, a, t[p + <span class="number">2</span>], <span class="number">15</span>, <span class="number">718787259</span>),</span><br><span class="line">            a = <span class="title function_">f</span>(a, s, d, n, t[p + <span class="number">9</span>], <span class="number">21</span>, -<span class="number">343485551</span>),</span><br><span class="line">            n = <span class="title function_">i</span>(n, h),</span><br><span class="line">            a = <span class="title function_">i</span>(a, v),</span><br><span class="line">            s = <span class="title function_">i</span>(s, m),</span><br><span class="line">            d = <span class="title function_">i</span>(d, y)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">r</span>(n) + <span class="title function_">r</span>(a) + <span class="title function_">r</span>(s) + <span class="title function_">r</span>(d)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> p = <span class="string">&quot;0123456789abcdef&quot;</span>;</span><br><span class="line">    e.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">e, t</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">d</span>(e + (t || <span class="string">&quot;&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了确保能用，找块地粘贴运行，需要把最后的<code>e.exports = </code>替换成<code>return</code>，最后加上函数名<code>s</code>。没有问题。</p>
<p>继续上面<code>u.a.encoder(s()(e, c.h)).charAt(2)</code>的过程，还差最外面的<code>u.a.encoder</code>。找到定义部分，完成抠下来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">, <span class="keyword">function</span>(<span class="params">e, t, n</span>) &#123;</span><br><span class="line">    <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> r = [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;E&quot;</span>, <span class="string">&quot;F&quot;</span>, <span class="string">&quot;G&quot;</span>, <span class="string">&quot;H&quot;</span>, <span class="string">&quot;I&quot;</span>, <span class="string">&quot;J&quot;</span>, <span class="string">&quot;K&quot;</span>, <span class="string">&quot;L&quot;</span>, <span class="string">&quot;M&quot;</span>, <span class="string">&quot;N&quot;</span>, <span class="string">&quot;O&quot;</span>, <span class="string">&quot;P&quot;</span>, <span class="string">&quot;Q&quot;</span>, <span class="string">&quot;R&quot;</span>, <span class="string">&quot;S&quot;</span>, <span class="string">&quot;T&quot;</span>, <span class="string">&quot;U&quot;</span>, <span class="string">&quot;V&quot;</span>, <span class="string">&quot;W&quot;</span>, <span class="string">&quot;X&quot;</span>, <span class="string">&quot;Y&quot;</span>, <span class="string">&quot;Z&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;f&quot;</span>, <span class="string">&quot;g&quot;</span>, <span class="string">&quot;h&quot;</span>, <span class="string">&quot;i&quot;</span>, <span class="string">&quot;j&quot;</span>, <span class="string">&quot;k&quot;</span>, <span class="string">&quot;l&quot;</span>, <span class="string">&quot;m&quot;</span>, <span class="string">&quot;n&quot;</span>, <span class="string">&quot;o&quot;</span>, <span class="string">&quot;p&quot;</span>, <span class="string">&quot;q&quot;</span>, <span class="string">&quot;r&quot;</span>, <span class="string">&quot;s&quot;</span>, <span class="string">&quot;t&quot;</span>, <span class="string">&quot;u&quot;</span>, <span class="string">&quot;v&quot;</span>, <span class="string">&quot;w&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;z&quot;</span>, <span class="string">&quot;0&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;6&quot;</span>, <span class="string">&quot;7&quot;</span>, <span class="string">&quot;8&quot;</span>, <span class="string">&quot;9&quot;</span>, <span class="string">&quot;+&quot;</span>, <span class="string">&quot;/&quot;</span>]</span><br><span class="line">      , a = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> t = <span class="keyword">new</span> <span class="title class_">Array</span>; e &gt; <span class="number">0</span>; ) &#123;</span><br><span class="line">            <span class="keyword">var</span> n = e % <span class="number">2</span>;</span><br><span class="line">            e = <span class="title class_">Math</span>.<span class="title function_">floor</span>(e / <span class="number">2</span>),</span><br><span class="line">            t.<span class="title function_">push</span>(n)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> t.<span class="title function_">reverse</span>(),</span><br><span class="line">        t</span><br><span class="line">    &#125;</span><br><span class="line">      , o = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> t = <span class="number">0</span>, n = <span class="number">0</span>, r = e.<span class="property">length</span> - <span class="number">1</span>; r &gt;= <span class="number">0</span>; --r) &#123;</span><br><span class="line">            <span class="number">1</span> == e[r] &amp;&amp; (t += <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, n)),</span><br><span class="line">            ++n</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> t</span><br><span class="line">    &#125;</span><br><span class="line">      , i = <span class="keyword">function</span>(<span class="params">e, t</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> n = <span class="number">8</span> - (e + <span class="number">1</span>) + <span class="number">6</span> * (e - <span class="number">1</span>), r = t.<span class="property">length</span>, a = n - r; --a &gt;= <span class="number">0</span>; )</span><br><span class="line">            t.<span class="title function_">unshift</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> o = [], i = e; --i &gt;= <span class="number">0</span>; )</span><br><span class="line">            o.<span class="title function_">push</span>(<span class="number">1</span>);</span><br><span class="line">        o.<span class="title function_">push</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> s = <span class="number">0</span>, u = <span class="number">8</span> - (e + <span class="number">1</span>); s &lt; u; ++s)</span><br><span class="line">            o.<span class="title function_">push</span>(t[s]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> l = <span class="number">0</span>; l &lt; e - <span class="number">1</span>; ++l) &#123;</span><br><span class="line">            o.<span class="title function_">push</span>(<span class="number">1</span>),</span><br><span class="line">            o.<span class="title function_">push</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> c = <span class="number">6</span>; --c &gt;= <span class="number">0</span>; )</span><br><span class="line">                o.<span class="title function_">push</span>(t[s++])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> o</span><br><span class="line">    &#125;</span><br><span class="line">      , s = &#123;</span><br><span class="line">        <span class="attr">encoder</span>: <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> t = [], n = [], s = <span class="number">0</span>, u = e.<span class="property">length</span>; s &lt; u; ++s) &#123;</span><br><span class="line">                <span class="keyword">var</span> l = e.<span class="title function_">charCodeAt</span>(s)</span><br><span class="line">                  , c = <span class="title function_">a</span>(l);</span><br><span class="line">                <span class="keyword">if</span> (l &lt; <span class="number">128</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> d = <span class="number">8</span> - c.<span class="property">length</span>; --d &gt;= <span class="number">0</span>; )</span><br><span class="line">                        c.<span class="title function_">unshift</span>(<span class="number">0</span>);</span><br><span class="line">                    n = n.<span class="title function_">concat</span>(c)</span><br><span class="line">                &#125; <span class="keyword">else</span></span><br><span class="line">                    l &gt;= <span class="number">128</span> &amp;&amp; l &lt;= <span class="number">2047</span> ? n = n.<span class="title function_">concat</span>(<span class="title function_">i</span>(<span class="number">2</span>, c)) : l &gt;= <span class="number">2048</span> &amp;&amp; l &lt;= <span class="number">65535</span> ? n = n.<span class="title function_">concat</span>(<span class="title function_">i</span>(<span class="number">3</span>, c)) : l &gt;= <span class="number">65536</span> &amp;&amp; l &lt;= <span class="number">2097151</span> ? n = n.<span class="title function_">concat</span>(<span class="title function_">i</span>(<span class="number">4</span>, c)) : l &gt;= <span class="number">2097152</span> &amp;&amp; l &lt;= <span class="number">67108863</span> ? n = n.<span class="title function_">concat</span>(<span class="title function_">i</span>(<span class="number">5</span>, c)) : l &gt;= <span class="number">4e6</span> &amp;&amp; l &lt;= <span class="number">2147483647</span> &amp;&amp; (n = n.<span class="title function_">concat</span>(<span class="title function_">i</span>(<span class="number">6</span>, c)))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> f = <span class="number">0</span>, s = <span class="number">0</span>, u = n.<span class="property">length</span>; s &lt; u; s += <span class="number">6</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> p = s + <span class="number">6</span> - u;</span><br><span class="line">                <span class="number">2</span> == p ? f = <span class="number">2</span> : <span class="number">4</span> == p &amp;&amp; (f = <span class="number">4</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> h = f; --h &gt;= <span class="number">0</span>; )</span><br><span class="line">                    n.<span class="title function_">push</span>(<span class="number">0</span>);</span><br><span class="line">                t.<span class="title function_">push</span>(<span class="title function_">o</span>(n.<span class="title function_">slice</span>(s, s + <span class="number">6</span>)))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> m = <span class="string">&quot;&quot;</span>, s = <span class="number">0</span>, u = t.<span class="property">length</span>; s &lt; u; ++s)</span><br><span class="line">                m += r[t[s]];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> s = <span class="number">0</span>, u = f / <span class="number">2</span>; s &lt; u; ++s)</span><br><span class="line">                m += <span class="string">&quot;=&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> m</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">decoder</span>: <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> t = e.<span class="property">length</span></span><br><span class="line">              , n = <span class="number">0</span>;</span><br><span class="line">            <span class="string">&quot;=&quot;</span> == e.<span class="title function_">charAt</span>(t - <span class="number">1</span>) &amp;&amp; (<span class="string">&quot;=&quot;</span> == e.<span class="title function_">charAt</span>(t - <span class="number">2</span>) ? (n = <span class="number">4</span>,</span><br><span class="line">            e = e.<span class="title function_">substring</span>(<span class="number">0</span>, t - <span class="number">2</span>)) : (n = <span class="number">2</span>,</span><br><span class="line">            e = e.<span class="title function_">substring</span>(<span class="number">0</span>, t - <span class="number">1</span>)));</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = [], s = <span class="number">0</span>, u = e.<span class="property">length</span>; s &lt; u; ++s)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> l = e.<span class="title function_">charAt</span>(s), c = <span class="number">0</span>, d = r.<span class="property">length</span>; c &lt; d; ++c)</span><br><span class="line">                    <span class="keyword">if</span> (l == r[c]) &#123;</span><br><span class="line">                        <span class="keyword">var</span> f = <span class="title function_">a</span>(c)</span><br><span class="line">                          , p = f.<span class="property">length</span>;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="number">6</span> - p &gt; <span class="number">0</span>)</span><br><span class="line">                            <span class="keyword">for</span> (<span class="keyword">var</span> h = <span class="number">6</span> - p; h &gt; <span class="number">0</span>; --h)</span><br><span class="line">                                f.<span class="title function_">unshift</span>(<span class="number">0</span>);</span><br><span class="line">                        i = i.<span class="title function_">concat</span>(f);</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    &#125;</span><br><span class="line">            n &gt; <span class="number">0</span> &amp;&amp; (i = i.<span class="title function_">slice</span>(<span class="number">0</span>, i.<span class="property">length</span> - n));</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> m = [], v = [], s = <span class="number">0</span>, u = i.<span class="property">length</span>; s &lt; u; )</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> == i[s])</span><br><span class="line">                    m = m.<span class="title function_">concat</span>(<span class="title function_">o</span>(i.<span class="title function_">slice</span>(s, s + <span class="number">8</span>))),</span><br><span class="line">                    s += <span class="number">8</span>;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> g = <span class="number">0</span>; s &lt; u &amp;&amp; <span class="number">1</span> == i[s]; )</span><br><span class="line">                        ++g,</span><br><span class="line">                        ++s;</span><br><span class="line">                    <span class="keyword">for</span> (v = v.<span class="title function_">concat</span>(i.<span class="title function_">slice</span>(s + <span class="number">1</span>, s + <span class="number">8</span> - g)),</span><br><span class="line">                    s += <span class="number">8</span> - g; g &gt; <span class="number">1</span>; )</span><br><span class="line">                        v = v.<span class="title function_">concat</span>(i.<span class="title function_">slice</span>(s + <span class="number">2</span>, s + <span class="number">8</span>)),</span><br><span class="line">                        s += <span class="number">8</span>,</span><br><span class="line">                        --g;</span><br><span class="line">                    m = m.<span class="title function_">concat</span>(<span class="title function_">o</span>(v)),</span><br><span class="line">                    v = []</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">return</span> m</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    t.<span class="property">a</span> = s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同样的具体逻辑不管，我们只需要调用函数内的<code>encoder</code>即可。稍加改造：加上函数名，我们还需要在外面传入对象<code>t</code>，最终调用<code>t.a.encoder</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> u = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> e = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">e, t, n</span>)&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">foo</span>(e, u, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">n.<span class="property">a</span>.<span class="title function_">encoder</span>(<span class="string">&#x27;xxx&#x27;</span>);  <span class="comment">// 调用</span></span><br></pre></td></tr></table></figure>

<p>最后结果取<code>charAt(2)</code>单个字符，再拼接<code>wWin7/Chrome100/xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx</code>，就是最终的device_id了。</p>
<h2 id="login-name-amp-password"><a href="#login-name-amp-password" class="headerlink" title="login_name&amp;password"></a>login_name&amp;password</h2><p>全局搜索关键字，定位到明文到密文的加密代码段：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">t.<span class="property">_login</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> e = <span class="variable language_">this</span></span><br><span class="line">	  , t = <span class="variable language_">arguments</span>.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">void</span> <span class="number">0</span> !== <span class="variable language_">arguments</span>[<span class="number">0</span>] ? <span class="variable language_">arguments</span>[<span class="number">0</span>] : &#123;&#125;</span><br><span class="line">	  , n = t.<span class="property">loginName</span>  <span class="comment">// 用户名明文</span></span><br><span class="line">	  , r = t.<span class="property">password</span>   <span class="comment">// 密码明文</span></span><br><span class="line">	  , a = t.<span class="property">identifyCode</span></span><br><span class="line">	  , o = t.<span class="property">loginNameType</span></span><br><span class="line">	  , i = t.<span class="property">accountType</span></span><br><span class="line">	  , s = t.<span class="property">countryCode</span></span><br><span class="line">	  , u = t.<span class="property">orgCode</span></span><br><span class="line">	  , l = t.<span class="property">isGetTicketForLogin</span></span><br><span class="line">	  , c = <span class="variable language_">arguments</span>.<span class="property">length</span> &gt; <span class="number">1</span> ? <span class="variable language_">arguments</span>[<span class="number">1</span>] : <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">getSession</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">t</span>) &#123;</span><br><span class="line">		<span class="keyword">var</span> d = t.<span class="property">session_id</span></span><br><span class="line">		  , f = t.<span class="property">session_key</span></span><br><span class="line">		  , p = <span class="title class_">Object</span>(B.<span class="property">d</span>)(n, f)   <span class="comment">// 用户名加密过程</span></span><br><span class="line">		  , h = <span class="title class_">Object</span>(B.<span class="property">d</span>)(<span class="title function_">N</span>()(r, G.<span class="property">h</span>), f)  <span class="comment">// 密码加密过程</span></span><br><span class="line">		  , m = &#123;</span><br><span class="line">			<span class="attr">session_id</span>: d,</span><br><span class="line">			<span class="attr">login_name_type</span>: o,</span><br><span class="line">			<span class="attr">login_name</span>: p,  <span class="comment">// 最终提交用户名</span></span><br><span class="line">			<span class="attr">account_type</span>: i,</span><br><span class="line">			<span class="attr">country_code</span>: s,</span><br><span class="line">			<span class="attr">org_code</span>: u,</span><br><span class="line">			<span class="attr">password</span>: h,  <span class="comment">// 最终提交密码</span></span><br><span class="line">			<span class="attr">identify_code</span>: a</span><br><span class="line">		&#125;;</span><br><span class="line">		<span class="keyword">return</span> l ? e.<span class="property">_ucGateway</span>.<span class="title function_">getLoginTicketByPassword</span>(m) : e.<span class="property">_ucGateway</span>.<span class="title function_">loginByPassword</span>(m).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="title class_">Object</span>(B.<span class="property">b</span>)(e, f)</span><br><span class="line">		&#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">t</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> e.<span class="property">_ucToken</span>.<span class="title function_">saveToken</span>(t, c)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>n, r</code>对应用户名密码明文，<code>p, h</code>对应密文。加密过程分别为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">, p = <span class="title class_">Object</span>(B.<span class="property">d</span>)(n, f)   <span class="comment">// 用户名加密过程</span></span><br><span class="line">, h = <span class="title class_">Object</span>(B.<span class="property">d</span>)(<span class="title function_">N</span>()(r, G.<span class="property">h</span>), f)  <span class="comment">// 密码加密过程</span></span><br></pre></td></tr></table></figure>

<p>先看用户名。<code>f</code>是<code>session_key</code>由sessions请求得到，断点找到<code>B.d</code>定义处：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">r</span>(<span class="params">e, t</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> e += <span class="string">&quot;&quot;</span>,</span><br><span class="line">    s.<span class="property">a</span>.<span class="property">DES</span>.<span class="title function_">encrypt</span>(e, s.<span class="property">a</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(t), &#123;</span><br><span class="line">        <span class="attr">mode</span>: s.<span class="property">a</span>.<span class="property">mode</span>.<span class="property">ECB</span>,</span><br><span class="line">        <span class="attr">padding</span>: s.<span class="property">a</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">    &#125;).<span class="title function_">toString</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>DES对称加密算法，ECB移位模式，<code>Pkcs7</code>填充方式。因为是经典加密算法，扣代码太长了，直接调用Python或Node.js的加密库<a target="_blank" rel="noopener" href="https://cryptojs.gitbook.io/">cryptojs</a>。第一参数是明文，第二参数秘钥使用session_key。</p>
<p>密码加密多了一步<code>N()</code>，查看<code>G.h</code>，是字符串<code>£¬¡£fdjf,jkgfkl</code>，和前面分析过的<code>s()(e, c.h)</code>一样，<code>N()</code>即<code>s()</code>，<code>G.h</code>即<code>c.h</code>。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>node.js实现请参考：<a target="_blank" rel="noopener" href="https://stackblitz.com/edit/node-zxxedu">https://stackblitz.com/edit/node-zxxedu</a></p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2022/06/28/%E7%8C%BF%E4%BA%BA%E5%AD%A6JS%E6%B7%B7%E6%B7%86%E5%88%86%E6%9E%90%E7%AC%AC%E5%9B%9B%E9%A2%98/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>上一页</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="更新时间"></i>
              2022-07-25 10:00:11
            </span>
            
                  <span class="post-tags">
                    <i class="iconfont icon-tags" title="标签"></i>
                    
                    <span class="span--tag">
                      <a href="/tags/js%E9%80%86%E5%90%91/" title="js逆向">
                        <b>#</b> js逆向
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">目录</div>
    <div class="catalog-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E5%9D%80"><span class="toc-text">网址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95"><span class="toc-text">登录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tokens"><span class="toc-text">tokens</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sessions"><span class="toc-text">sessions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#device-id"><span class="toc-text">device_id</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#login-name-amp-password"><span class="toc-text">login_name&amp;password</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol>
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        






  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

  <div id="gitalk-container"></div>

  <script>
    const gitalk = new Gitalk({
      clientID: '5701baa041ba27d28c94',
      clientSecret: '87f7280a5901e8c3d5f84bd9ee65f993bdf43640',
      repo: 'juaran.github.io',
      owner: 'Juaran',
      admin: ['Juaran'],
      id: decodeURI(location.pathname),
      distractionFreeMode: false
    })

    gitalk.render('gitalk-container')
  </script>


      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/juaran">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/juaran">Copyright © 2022 Vic2ray</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        


        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        

      </div>
    </div>
  </body>
</html>
