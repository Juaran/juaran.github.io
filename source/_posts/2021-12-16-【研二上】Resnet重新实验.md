---
title: 【研二上】Resnet重新实验
date: 2021-12-17
category: 机器学习
tag: 周报
---



上周初步了解了无监督方法，注意到使用无监督异常检测能够达到较高的检测率。在之前的模型上已经取得一定效果，现希望能够降低检测精确度，从而提高检出异常数量，因此做了以下改进：

### 重新实验

上个月使用Resnet在CERT r4.2数据集上进行实验，取得了初步的结果。但当时的实验做的略显粗糙，于是重新审查了下训练和测试代码，参考了别人的模型训练过程，做了以下改进：

1. 每个样本使用500维特征向量。之前实验仅取最重要的60维
2. 将特征向量转为20x25的二维矩阵表示。论文第一个创新点，目的是利用卷积融合多域特征
3. 提高训练集中异常数据比例。之前实验维持不平衡比例(0.3%)，训练开销大，现将比例调整为1:3
4. 按需调整学习率MultiStepLR
5. 保存最优模型(**best model**)和最后的模型(last model)。之前实验只取了最后一轮的模型进行测试

以上实验方法的改进是有考虑的。首先，初始特征应该尽量保留，降维会丢失信息；其次，按异常数据比例来划分训练集和测试集，在训练时让异常与正常数据比例尽量均衡，只要模型最终在测试集上有效果，就是好的模型；最后，最后一轮得到的模型往往并是最好的模型，实际情况应该取训练过程中最好的模型。

200 epochs，取召回率（检测率）评估结果：

### Best model results

```
resnet34_no                    90.3774288
bam_resnet34_channel        87.22384882
bam_resnet34_spatial        90.90303229
bam_resnet34_joint            88.51968633
se_resnet34_channel            88.10446142
cbam_resnet34_joint            91.08208268
cbam_resnet34_channel        91.92799083
cbam_resnet34_spatial        91.11320407
resnet50_no                    84.46745562
bam_resnet50_channel        77.66272189
bam_resnet50_spatial        87.86982248
bam_resnet50_joint            84.02366863
se_resnet50_channel            81.50887573
cbam_resnet50_joint            92.45562130
cbam_resnet50_channel         80.91715976
cbam_resnet50_spatial        89.05325443
```

### Last model results

```
resnet34_no: 60.05917159763313
bam_resnet34_channel: 57.84023668639053
bam_resnet34_spatial: 61.390532544378694
bam_resnet34_joint: 57.100591715976336
se_resnet34_channel: 59.171597633136095
cbam_resnet34_joint: 62.42603550295858
cbam_resnet34_channel: 61.98224852071006
cbam_resnet34_spatial: 61.68639053254438
resnet50_no: 56.80473372781065
bam_resnet50_channel: 58.4319526627219
bam_resnet50_spatial: 60.05917159763313
bam_resnet50_joint: 57.692307692307686
se_resnet50_channel: 62.278106508875744
cbam_resnet50_joint: 64.94082840236686
cbam_resnet50_channel: 57.100591715976336
cbam_resnet50_spatial: 58.28402366863905
```

### Analysis

- 最优模型结果有更高的检测率（recall），但误检率较高（fpr）
- 最后模型结果检测率较低，但误检率较低，识别异常类别的精度更高
- 加深网络深度（34层到50层）带来的收益并不高，因为特征维数并不高
- 不同机制的注意力模块提升不同

随着轮次的增加，模型会倾向于提高异常类别的精确度，代价是检测率的下降。因此，利用最优模型可以尽最大努力检测出异常内部威胁行为，最后的模型则保证识别出来的异常具有较高的可靠性。这两种结果能为决策者提供有价值的参考。

### 调整F1-score

以上实验结果仅取了召回率作为最优模型的标准，虽然能检测出90%+的内部威胁实例，但是误检率（假阳性率）也很高。因此，使用F1-score作为最优模型的评估标准，即保证尽量多的异常实例，又保证尽量低的假阳性率：
$$
=F1_scoreβ=(1+β2)·Precision·Recallβ2·Precision+Recall
$$

$$
F = \frac {(1+\beta^2)Precision·Recall} { \beta^2·Precision +Recall}
$$

*β*用于调和Precision和Recall的重要性，当β=1时代表二者同等重要。因为数据集不平衡，因此异常实例的召回率的重要性要高于检测精度。经多次实验， 取β=4时能够保持较好的平衡。以下是Resnet34模型上的五次实验结果：

| Best Model |        | Last Model | 1      |
| ---------- | ------ | ---------- | ------ |
| 0          | FPR    | Recall     | FPR    |
| 1          | 0.1828 | 0.8200     | 0.0705 |
| 2          | 0.2235 | 0.8581     | 0.0774 |
| 3          | 0.2027 | 0.8131     | 0.0789 |
| 4          | 0.2577 | 0.8581     | 0.0757 |
| 5          | 0.2259 | 0.8512     | 0.0702 |

### 后续工作

使用单维特征向量的深度神经网络进行对比实验，以证明使用二维特征进行多域信息融合的有效性