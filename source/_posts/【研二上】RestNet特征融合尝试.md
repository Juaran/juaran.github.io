---

title: RestNet特征融合尝试
date: 2021-11-10
category: 内部威胁检测

---



### GCN on CERT

数据统计：330452条日实例数据，特征维数60，恶性实例占比0.3%

实验设置：训练集70%-测试集30%，采用上上周的首次将GCN应用在内部威胁检测上的论文方法构图：

> *Anomaly Detection with Graph Convolutional Networks for Insider Threat and Fraud Detection*

使用KNN计算topK个特征相似（余弦相似度）的近邻作为当前节点的邻节点，图的大小：<330452x330452>

<!-- more -->

输入GCN进行实验，实验结果如下：

              precision    recall  f1-score   support
     
           0       1.00      1.00      1.00     98846
           1       0.00      0.00      0.00       290
    accuracy                           1.00     99136
     
    Test set results: loss= 0.0199 accuracy= 0.9971
召回率（检测率）为0。分析原因是：

1. 样本分布不平衡。原文是基于用户进行检测，训练和测试时良性用户和恶性用户比例为4：1
2. 良性-良性、良性-恶性实例的相似度非常接近，无法确定分类临界值，导致GCN训练无效果

和涛神讨论后，去看了GCN源码，发现其对**引文网络**的训练、验证、测试划分如下：

``` python
idx_train = range(140)
idx_val = range(200, 500)
idx_test = range(500, 1500)
```

引文网络数据集cora包含了7个类别、1433维特征的2708个论文节点，以**引用关系为边**构图。在图神经网络学习时，仅对图中小部分节点（140）进行训练，将训练所得模型对300+1000个节点验证和测试。在训练集中，7类标签的节点分布不平衡，但每一个类别都包含。

再回顾第一篇使用GCN用于CERT威胁检测的文章，实验设置为：1000个用户节点，200个训练集，200个测试集

<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/image-20211020202908693.png" style="zoom:75%;" />

也就是说这样的实验设置是没有问题的。但论文是基于用户检测，恶性用户占比7%，数据较密集；目前工作基于实例检测，恶性实例占比0.3%，难以用以上方式划分数据集，且节点高达33w，没有找到的构图方案，因此基于GCN的威胁检测尝试告一段落。

### 多域特征融合

> Eldardiry, H., Bart, E., Juan Liu, Hanley, J., Price, B., & Brdiczka, O. (2013). *Multi-Domain Information Fusion for Insider Threat Detection. 2013 IEEE Security and Privacy Workshops.*
> doi:10.1109/spw.2013.14

文章提到了我上周考虑到的问题：

> 简单地将这些特征连接到一个单个特征向量中并不能很好地工作，因为来自不同域的特征可能有非常不同的范围（尺度）。由于缺乏适当的缩放，模型无法区分不同类型的活动，并限制了模型适当处理和解释不同活动类型的能力

因此，本文提出的方法在特征构建过程中**分别处理这些域**，同时**推理各个域之间的相互依赖关系**

多域异常检测思想：

1. 将用户按工作角色分类，相似工作角色的用户用户的行为应当属于每个域下的同一集群。直觉是，所有软件工程师在不同域上的行为接近，所有部门主管在不同域上的行为也接近
2. 确定用户在目标域是否与其他域表现一致。如果不一致，则标记为异常。如果该域集群不明显，则惩罚较小；对于非常可预测的域，不一致的表现将很可疑
3. 结合从每个域捕获的异常信息（融合），对每个用户做出最终决策

参考：https://blog.csdn.net/qq_36512295/article/details/92375075

### ResNet on CERT

基于之前的思考和上一篇文章的启发，将多域(multi-domain, or multi-modal, or multi-view, whatever)信息融合是解决该二分类问题的关键。不管是将特征聚类、离群点检测还是其他方法，目的都是尽可能提取出不同日志域之间的相互依赖关系（高维特征）。但是，现有的方法在处理特征时，往往将不同域的特征简单的concat，导致了不同域之间特征难以得到表达，使得模型的表现不佳（我猜的）。现有研究方法如下：

* Statistics：隐马尔科夫、高斯混合模型
* ML：决策树、逻辑回归、随机森林、梯度提升树、LSTM、一类SVM
* Graph Based：子图聚类、GCN、图嵌入
* DL：自动编码器、DNN、RNN、CNN

如果使用ResNet的短路连接来获得不同特征之间的组合表达，是否能达到不同域特征融合的目的？该设想如图所示。将行特征向量转为二维特征矩阵，**使用卷积核提取邻域之间的关联特征，使用短路连接融合跨域特征**：

<img src="https://cdn.jsdelivr.net/gh/juaran/juaran.github.io@image/typora/image-20211108093207631.png" alt="image-20211108093207631" style="zoom:75%;" />

数据统计：330,452总实例，966异常实例。训练集：70%，测试集：30%

Adagrad优化器，学习率0.001，100epoch训练测试结果：

```
              precision    recall  f1-score   support
 
           0       1.00      1.00      1.00     98846
           1       0.94      0.62      0.75       290
```

所得模型在准确预测了98846条正常实例，没有误判；在290条异常实例上达到了94%的精度和62%的召回率，虽然没有检测出全部的异常实例，但模型分类的可信度较高

第二次实验，使用20%训练集模型的测试结果：

```
               precision    recall  f1-score   support
 
           0       1.00      1.00      1.00    263589
           1       0.71      0.37      0.49       773
```

回看了学姐的论文，使用了三个评估指标：Accuracy、Recall、FPR，其中Recall能够达到92%，但是Accuracy只有88%，错检率（假阳性率）FPR高达12%，说明模型虽然能够检测出较多恶意行为，但是对于正常行为也有很高的误判，导致实际分类精度（Precision）很低，所以论文没有用精度作为评估标准。相比之下，以上实验表明模型在整体上有高的准确率和低的错检率，在保证分类精度的前提下，尽可能检测更多的恶意行为，而且在少量数据训练的情况下模型也能达到49%的F1分数。
